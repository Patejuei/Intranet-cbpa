import{c as ct,b as nt,r as Ae,u as Qe,j as t,H as ot,a as dt}from"./app-lrD-X_g2.js";import{B as K}from"./badge-CNMh2flQ.js";import{B as X}from"./button-C30YfVAU.js";import{C as Be}from"./checkbox-QaA0FavS.js";import{f as Ue,D as mt}from"./date-picker-D4LxhZpU.js";import{e as ht,b as We,D as Je,a as Ke,f as Xe,c as Ye,d as Ze}from"./dialog-BYWk1EVO.js";import{L as m}from"./label-BoHnEJCk.js";import{S as et,a as tt,b as st,c as lt,d as le}from"./select-CyJ-A37M.js";import{T as pt}from"./textarea-CHbthfTQ.js";import{A as xt}from"./app-layout-B-w059ge.js";import{P as ft}from"./plus-DUGX3CSH.js";import{E as it}from"./eye-DEjAMjhN.js";/* empty css            */import"./index-D28iW8MQ.js";import"./index-BxHzOl0z.js";import"./index-zozu2mmz.js";import"./check-KNjNtnR0.js";import"./chevron-left-BvRJ8iXd.js";import"./popover-BVeNiosq.js";import"./chevron-down-DC4OJ025.js";import"./index-C4J_hXM0.js";import"./shield-DP_TgMF-.js";function At(c){const e=ct.c(139),{issues:h,vehicles:De}=c,{auth:d}=nt().props,[Re,Le]=Ae.useState(!1),[qe,Me]=Ae.useState(!1),[Y,Ge]=Ae.useState(null);let ie;e[0]===Symbol.for("react.memo_cache_sentinel")?(ie={is_stopped:!1,sent_to_hq:!1,sent_to_workshop:!1},e[0]=ie):ie=e[0];const{data:n,setData:i,put:Fe,processing:Ie,reset:Te}=Qe(ie);let ae;e[1]===Symbol.for("react.memo_cache_sentinel")?(ae={vehicle_id:"",description:"",severity:"Low",date:Ue(new Date,"yyyy-MM-dd")},e[1]=ae):ae=e[1];const{data:a,setData:r,post:Ve,processing:Ee,errors:o,reset:Pe}=Qe(ae);let re;e[2]!==Ve||e[3]!==Pe?(re=s=>{s.preventDefault(),Ve("/vehicles/incidents",{onSuccess:()=>{Le(!1),Pe()}})},e[2]=Ve,e[3]=Pe,e[4]=re):re=e[4];const He=re;let ce;e[5]!==Fe||e[6]!==Te||e[7]!==Y?(ce=s=>{s.preventDefault(),Y&&Fe(`/vehicles/incidents/${Y.id}`,{onSuccess:()=>{Me(!1),Te(),Ge(null)}})},e[5]=Fe,e[6]=Te,e[7]=Y,e[8]=ce):ce=e[8];const Oe=ce;let ne;e[9]!==i?(ne=s=>{Ge(s),i({is_stopped:s.is_stopped,sent_to_hq:s.sent_to_hq,sent_to_workshop:s.sent_to_workshop}),Me(!0)},e[9]=i,e[10]=ne):ne=e[10];const Z=ne,$e=vt,at=ut,ee=d.user.role==="capitan"||d.user.role==="admin"||d.user.company==="Comandancia",te=d.user.role==="mechanic"||d.user.role==="admin",se=d.user.company==="Comandancia"||d.user.role==="admin";let oe,de;e[11]===Symbol.for("react.memo_cache_sentinel")?(oe=[{title:"Material Mayor",href:"/vehicles/dashboard"},{title:"Incidencias",href:"/vehicles/incidents"}],de=t.jsx(ot,{title:"Registro de Incidencias"}),e[11]=oe,e[12]=de):(oe=e[11],de=e[12]);let me;e[13]===Symbol.for("react.memo_cache_sentinel")?(me=t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Registro de Incidencias"}),t.jsx("p",{className:"text-muted-foreground",children:"Reporte y seguimiento de problemas mecánicos."})]}),e[13]=me):me=e[13];let he;e[14]===Symbol.for("react.memo_cache_sentinel")?(he=t.jsx(ht,{asChild:!0,children:t.jsxs(X,{children:[t.jsx(ft,{className:"mr-2 h-4 w-4"})," Nueva Incidencia"]})}),e[14]=he):he=e[14];let pe;e[15]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsxs(We,{children:[t.jsx(Je,{children:"Reportar Incidencia"}),t.jsx(Ke,{children:"Ingrese los detalles del problema detectado en la unidad."})]}),e[15]=pe):pe=e[15];let xe;e[16]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsx(m,{htmlFor:"vehicle",children:"Vehículo"}),e[16]=xe):xe=e[16];let p;e[17]!==r?(p=s=>r("vehicle_id",s),e[17]=r,e[18]=p):p=e[18];const rt=a.vehicle_id;let fe;e[19]===Symbol.for("react.memo_cache_sentinel")?(fe=t.jsx(tt,{children:t.jsx(st,{placeholder:"Seleccione unidad"})}),e[19]=fe):fe=e[19];let x;e[20]!==De?(x=De.map(jt),e[20]=De,e[21]=x):x=e[21];let f;e[22]!==x?(f=t.jsx(lt,{children:x}),e[22]=x,e[23]=f):f=e[23];let j;e[24]!==a.vehicle_id||e[25]!==p||e[26]!==f?(j=t.jsxs(et,{onValueChange:p,value:rt,children:[fe,f]}),e[24]=a.vehicle_id,e[25]=p,e[26]=f,e[27]=j):j=e[27];let u;e[28]!==o.vehicle_id?(u=o.vehicle_id&&t.jsx("p",{className:"text-sm text-destructive",children:o.vehicle_id}),e[28]=o.vehicle_id,e[29]=u):u=e[29];let v;e[30]!==j||e[31]!==u?(v=t.jsxs("div",{className:"grid gap-2",children:[xe,j,u]}),e[30]=j,e[31]=u,e[32]=v):v=e[32];let je;e[33]===Symbol.for("react.memo_cache_sentinel")?(je=t.jsx(m,{htmlFor:"severity",children:"Severidad"}),e[33]=je):je=e[33];let _;e[34]!==r?(_=s=>r("severity",s),e[34]=r,e[35]=_):_=e[35];let ue;e[36]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx(tt,{children:t.jsx(st,{placeholder:"Nivel de Gravedad"})}),e[36]=ue):ue=e[36];let ve;e[37]===Symbol.for("react.memo_cache_sentinel")?(ve=t.jsxs(lt,{children:[t.jsx(le,{value:"Low",children:"Baja (Observación)"}),t.jsx(le,{value:"Medium",children:"Media (Reparación necesaria)"}),t.jsx(le,{value:"High",children:"Alta (Riesgo operativo)"}),t.jsx(le,{value:"Critical",children:"Crítica (Inoperativo)"})]}),e[37]=ve):ve=e[37];let g;e[38]!==a.severity||e[39]!==_?(g=t.jsxs("div",{className:"grid gap-2",children:[je,t.jsxs(et,{onValueChange:_,value:a.severity,children:[ue,ve]})]}),e[38]=a.severity,e[39]=_,e[40]=g):g=e[40];let _e;e[41]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsx(m,{htmlFor:"date",children:"Fecha Detección"}),e[41]=_e):_e=e[41];let b;e[42]!==r?(b=s=>r("date",s?Ue(s,"yyyy-MM-dd"):""),e[42]=r,e[43]=b):b=e[43];let N;e[44]!==a.date||e[45]!==b?(N=t.jsxs("div",{className:"grid gap-2",children:[_e,t.jsx(mt,{date:a.date,setDate:b})]}),e[44]=a.date,e[45]=b,e[46]=N):N=e[46];let ge;e[47]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsx(m,{htmlFor:"description",children:"Descripción del Problema"}),e[47]=ge):ge=e[47];let y;e[48]!==r?(y=s=>r("description",s.target.value),e[48]=r,e[49]=y):y=e[49];let w;e[50]!==a.description||e[51]!==y?(w=t.jsx(pt,{id:"description",value:a.description,onChange:y,placeholder:"Detalle el problema, observaciones, etc."}),e[50]=a.description,e[51]=y,e[52]=w):w=e[52];let S;e[53]!==o.description?(S=o.description&&t.jsx("p",{className:"text-sm text-destructive",children:o.description}),e[53]=o.description,e[54]=S):S=e[54];let C;e[55]!==w||e[56]!==S?(C=t.jsxs("div",{className:"grid gap-2",children:[ge,w,S]}),e[55]=w,e[56]=S,e[57]=C):C=e[57];let k;e[58]!==v||e[59]!==g||e[60]!==N||e[61]!==C?(k=t.jsxs("div",{className:"grid gap-4 py-4",children:[v,g,N,C]}),e[58]=v,e[59]=g,e[60]=N,e[61]=C,e[62]=k):k=e[62];let D;e[63]!==Ee?(D=t.jsx(Xe,{children:t.jsx(X,{type:"submit",disabled:Ee,children:"Reportar"})}),e[63]=Ee,e[64]=D):D=e[64];let R;e[65]!==He||e[66]!==k||e[67]!==D?(R=t.jsx(Ye,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:He,children:[pe,k,D]})}),e[65]=He,e[66]=k,e[67]=D,e[68]=R):R=e[68];let q;e[69]!==Re||e[70]!==R?(q=t.jsxs(Ze,{open:Re,onOpenChange:Le,children:[he,R]}),e[69]=Re,e[70]=R,e[71]=q):q=e[71];let be;e[72]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsx(Je,{children:"Revisión de Incidencia"}),e[72]=be):be=e[72];const ze=Y?.vehicle.name;let M;e[73]!==ze?(M=t.jsxs(We,{children:[be,t.jsxs(Ke,{children:["Determinar acciones a seguir para"," ",ze]})]}),e[73]=ze,e[74]=M):M=e[74];let F;e[75]!==i?(F=s=>i("is_stopped",s),e[75]=i,e[76]=F):F=e[76];let I;e[77]!==n.is_stopped||e[78]!==F?(I=t.jsx(Be,{id:"review_is_stopped",checked:n.is_stopped,onCheckedChange:F}),e[77]=n.is_stopped,e[78]=F,e[79]=I):I=e[79];let Ne;e[80]===Symbol.for("react.memo_cache_sentinel")?(Ne=t.jsx(m,{htmlFor:"review_is_stopped",className:"font-bold text-destructive",children:"Material Fuera de Servicio"}),e[80]=Ne):Ne=e[80];let T;e[81]!==I?(T=t.jsxs("div",{className:"flex items-center space-x-2",children:[I,Ne]}),e[81]=I,e[82]=T):T=e[82];let ye;e[83]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx("h4",{className:"text-sm font-medium",children:"Notificaciones"}),e[83]=ye):ye=e[83];let V;e[84]!==i?(V=s=>i("sent_to_hq",s),e[84]=i,e[85]=V):V=e[85];let E;e[86]!==n.sent_to_hq||e[87]!==V?(E=t.jsx(Be,{id:"sent_to_hq",checked:n.sent_to_hq,onCheckedChange:V}),e[86]=n.sent_to_hq,e[87]=V,e[88]=E):E=e[88];let we;e[89]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx(m,{htmlFor:"sent_to_hq",children:"Reportar a Comandancia"}),e[89]=we):we=e[89];let P;e[90]!==E?(P=t.jsxs("div",{className:"flex items-center space-x-2",children:[E,we]}),e[90]=E,e[91]=P):P=e[91];let H;e[92]!==i?(H=s=>i("sent_to_workshop",s),e[92]=i,e[93]=H):H=e[93];let O;e[94]!==n.sent_to_workshop||e[95]!==H?(O=t.jsx(Be,{id:"sent_to_workshop",checked:n.sent_to_workshop,onCheckedChange:H}),e[94]=n.sent_to_workshop,e[95]=H,e[96]=O):O=e[96];let Se;e[97]===Symbol.for("react.memo_cache_sentinel")?(Se=t.jsx(m,{htmlFor:"sent_to_workshop",children:"Reportar a Taller Mecánico"}),e[97]=Se):Se=e[97];let z;e[98]!==O?(z=t.jsxs("div",{className:"flex items-center space-x-2",children:[O,Se]}),e[98]=O,e[99]=z):z=e[99];let A;e[100]!==P||e[101]!==z?(A=t.jsxs("div",{className:"space-y-2 border-t pt-4",children:[ye,P,z]}),e[100]=P,e[101]=z,e[102]=A):A=e[102];let B;e[103]!==T||e[104]!==A?(B=t.jsxs("div",{className:"grid gap-4 py-4",children:[T,A]}),e[103]=T,e[104]=A,e[105]=B):B=e[105];let L;e[106]!==Ie?(L=t.jsx(Xe,{children:t.jsx(X,{type:"submit",disabled:Ie,children:"Guardar Revisión"})}),e[106]=Ie,e[107]=L):L=e[107];let G;e[108]!==Oe||e[109]!==M||e[110]!==B||e[111]!==L?(G=t.jsx(Ye,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:Oe,children:[M,B,L]})}),e[108]=Oe,e[109]=M,e[110]=B,e[111]=L,e[112]=G):G=e[112];let $;e[113]!==qe||e[114]!==G?($=t.jsx(Ze,{open:qe,onOpenChange:Me,children:G}),e[113]=qe,e[114]=G,e[115]=$):$=e[115];let Q;e[116]!==q||e[117]!==$?(Q=t.jsxs("div",{className:"flex items-center justify-between",children:[me,q,$]}),e[116]=q,e[117]=$,e[118]=Q):Q=e[118];let Ce;e[119]===Symbol.for("react.memo_cache_sentinel")?(Ce=t.jsx("thead",{className:"[&_tr]:border-b",children:t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:[t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Fecha"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Unidad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Gravedad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Descripción"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Estado"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Reportado Por"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Acciones"})]})}),e[119]=Ce):Ce=e[119];let U;if(e[120]!==ee||e[121]!==se||e[122]!==te||e[123]!==h.data||e[124]!==Z){let s;e[126]!==ee||e[127]!==se||e[128]!==te||e[129]!==Z?(s=l=>t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50",children:[t.jsx("td",{className:"p-4 align-middle",children:l.date}),t.jsx("td",{className:"p-4 align-middle font-medium",children:l.vehicle.name}),t.jsx("td",{className:"p-4 align-middle",children:t.jsx(K,{variant:at(l.severity),children:l.severity})}),t.jsx("td",{className:"max-w-[300px] truncate p-4 align-middle",children:l.description}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[l.is_stopped&&t.jsx(K,{variant:"destructive",className:"w-fit",children:"Detenido"}),!l.reviewed_at&&t.jsx(K,{variant:"outline",className:"w-fit border-yellow-500 text-yellow-600",children:"Pendiente Revisión"}),l.reviewed_at&&t.jsx(K,{variant:"outline",className:"w-fit border-blue-500 text-blue-600",children:"Revisado"}),l.sent_to_hq&&t.jsx(K,{variant:l.hq_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.hq_read_at?"Visto Comandancia":"Enviado Comandancia"}),l.sent_to_workshop&&t.jsx(K,{variant:l.workshop_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.workshop_read_at?"Visto Taller":"Enviado Taller"})]})}),t.jsx("td",{className:"p-4 align-middle",children:l.reporter?.name||"Desconocido"}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex gap-2",children:[ee&&t.jsx(X,{size:"sm",variant:"outline",onClick:()=>Z(l),children:"Revisar"}),te&&l.sent_to_workshop&&!l.workshop_read_at&&t.jsxs(X,{size:"sm",variant:"ghost",onClick:()=>$e(l),title:"Marcar como Visto",children:[t.jsx(it,{className:"mr-1 size-4"})," ","Taller"]}),se&&l.sent_to_hq&&!l.hq_read_at&&t.jsxs(X,{size:"sm",variant:"ghost",onClick:()=>$e(l),title:"Marcar como Visto",children:[t.jsx(it,{className:"mr-1 size-4"})," ","HQ"]})]})})]},l.id),e[126]=ee,e[127]=se,e[128]=te,e[129]=Z,e[130]=s):s=e[130],U=h.data.map(s),e[120]=ee,e[121]=se,e[122]=te,e[123]=h.data,e[124]=Z,e[125]=U}else U=e[125];let W;e[131]!==h.data.length?(W=h.data.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"p-4 text-center text-muted-foreground",children:"No hay incidencias registradas."})}),e[131]=h.data.length,e[132]=W):W=e[132];let J;e[133]!==U||e[134]!==W?(J=t.jsx("div",{className:"rounded-md border",children:t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsxs("table",{className:"w-full caption-bottom text-sm",children:[Ce,t.jsxs("tbody",{className:"[&_tr:last-child]:border-0",children:[U,W]})]})})}),e[133]=U,e[134]=W,e[135]=J):J=e[135];let ke;return e[136]!==Q||e[137]!==J?(ke=t.jsxs(xt,{breadcrumbs:oe,children:[de,t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[Q,J]})]}),e[136]=Q,e[137]=J,e[138]=ke):ke=e[138],ke}function jt(c){return t.jsx(le,{value:c.id.toString(),children:c.name},c.id)}function ut(c){switch(c){case"Critical":return"destructive";case"High":return"destructive";case"Medium":return"secondary";default:return"outline"}}function vt(c){dt.patch(`/vehicles/incidents/${c.id}/mark-read`,{},{preserveScroll:!0})}export{At as default};
