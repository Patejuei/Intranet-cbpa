import{c as W,b as X,u as U,j as s,a as F,L as O,H as Y}from"./app-B61HxmhB.js";import{B as w}from"./badge-vEvJTU3_.js";import{a as Z,B as v,f as ee}from"./button-DEfvv7zK.js";import{E as se,G as te,H as ae,I as H,F as re,A as ie}from"./app-layout-B6JJyxYC.js";import{I as le}from"./input-BEDlWVnt.js";import{L as ne}from"./label-CID0YnKh.js";import{T as ce}from"./textarea-jhUVqLEV.js";import{U as oe}from"./user-DtXkKT30.js";import{S as de}from"./send-CjFZgcrw.js";import{A as me}from"./arrow-left-Cw0gj5yu.js";/* empty css            */import"./index-DnuNE2iH.js";import"./index-0lwPlNm7.js";import"./index-q7GIQJN5.js";import"./shield-BxyVENHa.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],J=Z("Paperclip",pe);function De(i){const e=W.c(65),{ticket:t}=i,{auth:q}=X().props,r=q.user;let _;e[0]===Symbol.for("react.memo_cache_sentinel")?(_={message:"",image:null},e[0]=_):_=e[0];const{data:k,setData:C,post:I,processing:S,reset:P}=U(_);let A;e[1]!==t.status?(A={status:t.status},e[1]=t.status,e[2]=A):A=e[2],U(A);let E;e[3]!==I||e[4]!==P||e[5]!==t.id?(E=a=>{a.preventDefault(),I(`/tickets/${t.id}/reply`,{onSuccess:()=>P()})},e[3]=I,e[4]=P,e[5]=t.id,e[6]=E):E=e[6];const L=E,G=he,V=xe,K=ue;let R,$;e[7]===Symbol.for("react.memo_cache_sentinel")?(R={title:"Panel Principal",href:"/dashboard"},$={title:"Ticketera",href:"/tickets"},e[7]=R,e[8]=$):(R=e[7],$=e[8]);const z=`Ticket #${t.id}`,B=`/tickets/${t.id}`;let l;e[9]!==z||e[10]!==B?(l=[R,$,{title:z,href:B}],e[9]=z,e[10]=B,e[11]=l):l=e[11];const M=`Ticket #${t.id}`;let n;e[12]!==M?(n=s.jsx(Y,{title:M}),e[12]=M,e[13]=n):n=e[13];let D;e[14]===Symbol.for("react.memo_cache_sentinel")?(D=s.jsx(v,{variant:"ghost",className:"w-fit gap-2 pl-0 hover:bg-transparent hover:text-primary",asChild:!0,children:s.jsxs(O,{href:"/tickets",children:[s.jsx(me,{className:"h-4 w-4"}),"Volver a Ticketera"]})}),e[14]=D):D=e[14];let c;e[15]!==t.id||e[16]!==t.subject?(c=s.jsxs("h2",{className:"text-xl font-bold",children:["#",t.id," - ",t.subject]}),e[15]=t.id,e[16]=t.subject,e[17]=c):c=e[17];let o;e[18]!==t.status?(o=G(t.status),e[18]=t.status,e[19]=o):o=e[19];let d;e[20]!==r.company||e[21]!==t.id||e[22]!==t.priority?(d=r.company==="Comandancia"?s.jsxs(se,{children:[s.jsx(te,{asChild:!0,children:s.jsxs(v,{variant:"outline",size:"sm",className:"h-6 gap-1 text-xs",children:[t.priority,s.jsx("span",{className:"sr-only",children:"Cambiar Prioridad"})]})}),s.jsxs(ae,{align:"start",children:[s.jsx(H,{onClick:()=>F.patch(`/tickets/${t.id}/priority`,{priority:"BAJA"}),children:"BAJA"}),s.jsx(H,{onClick:()=>F.patch(`/tickets/${t.id}/priority`,{priority:"MEDIA"}),children:"MEDIA"}),s.jsx(H,{onClick:()=>F.patch(`/tickets/${t.id}/priority`,{priority:"ALTA"}),children:"ALTA"})]})]}):s.jsx(w,{variant:"outline",children:t.priority}),e[20]=r.company,e[21]=t.id,e[22]=t.priority,e[23]=d):d=e[23];let m;e[24]!==c||e[25]!==o||e[26]!==d?(m=s.jsxs("div",{className:"flex items-center gap-2",children:[c,o,d]}),e[24]=c,e[25]=o,e[26]=d,e[27]=m):m=e[27];let p;e[28]!==t.user.name?(p=s.jsx("span",{className:"font-medium text-foreground",children:t.user.name}),e[28]=t.user.name,e[29]=p):p=e[29];const Q=t.company;let u;e[30]!==t.created_at?(u=ee(t.created_at),e[30]=t.created_at,e[31]=u):u=e[31];let x;e[32]!==p||e[33]!==u||e[34]!==t.company?(x=s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Iniciado por"," ",p," ","(",Q,") el"," ",u]}),e[32]=p,e[33]=u,e[34]=t.company,e[35]=x):x=e[35];let h;e[36]!==m||e[37]!==x?(h=s.jsxs("div",{className:"space-y-1",children:[m,x]}),e[36]=m,e[37]=x,e[38]=h):h=e[38];let f;e[39]!==r.company||e[40]!==t.id||e[41]!==t.status?(f=r.company==="Comandancia"&&s.jsxs("div",{className:"flex items-center gap-2",children:[t.status!=="ABIERTO"&&s.jsx(O,{href:`/tickets/${t.id}/status`,method:"patch",data:{status:"ABIERTO"},as:"button",children:s.jsx(v,{variant:"outline",size:"sm",children:"Reabrir"})}),t.status!=="EN_PROCESO"&&t.status!=="CERRADO"&&s.jsx(O,{href:`/tickets/${t.id}/status`,method:"patch",data:{status:"EN_PROCESO"},as:"button",children:s.jsx(v,{variant:"default",size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:"Marcar En Proceso"})}),t.status!=="CERRADO"&&s.jsx(O,{href:`/tickets/${t.id}/status`,method:"patch",data:{status:"CERRADO"},as:"button",children:s.jsx(v,{variant:"secondary",size:"sm",children:"Cerrar Ticket"})})]}),e[39]=r.company,e[40]=t.id,e[41]=t.status,e[42]=f):f=e[42];let g;e[43]!==h||e[44]!==f?(g=s.jsxs("div",{className:"flex flex-col justify-between gap-4 rounded-xl border bg-card p-4 shadow-sm md:flex-row md:p-6",children:[h,f]}),e[43]=h,e[44]=f,e[45]=g):g=e[45];let j;e[46]!==r.id||e[47]!==t.messages?(j=t.messages.length===0?s.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"No hay mensajes."}):t.messages.map(a=>s.jsxs("div",{className:`flex gap-3 ${a.user.id===r.id?"flex-row-reverse":""}`,children:[s.jsx("div",{className:"flex size-8 shrink-0 items-center justify-center rounded-full bg-primary/20",children:s.jsx(oe,{className:"size-4 text-primary"})}),s.jsxs("div",{className:`flex max-w-[80%] flex-col ${a.user.id===r.id?"items-end":""}`,children:[s.jsxs("div",{className:"mb-1 flex items-center gap-2",children:[s.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:a.user.name}),s.jsx("span",{className:"text-[10px] text-muted-foreground/70",children:new Date(a.created_at).toLocaleString()})]}),s.jsx("div",{className:`rounded-lg p-3 text-sm ${a.user.id===r.id?"rounded-tr-none bg-primary text-primary-foreground":"rounded-tl-none border bg-card shadow-sm"}`,children:s.jsx("p",{className:"whitespace-pre-wrap",children:a.message})}),a.image_path&&s.jsx("div",{className:"mt-2 text-sm",children:V(a.image_path)?s.jsx("div",{className:"max-w-[200px] overflow-hidden rounded-md border",children:s.jsx("a",{href:`/storage/${a.image_path}`,target:"_blank",rel:"noopener noreferrer",children:s.jsx("img",{src:`/storage/${a.image_path}`,alt:"Adjunto",className:"h-auto w-full"})})}):s.jsxs("a",{href:`/storage/${a.image_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 rounded border bg-background p-2 text-primary hover:bg-accent",children:[s.jsx(re,{className:"h-4 w-4"}),s.jsx("span",{className:"truncate underline",children:K(a.image_path)})]})})]})]},a.id)),e[46]=r.id,e[47]=t.messages,e[48]=j):j=e[48];let b;e[49]!==j?(b=s.jsx("div",{className:"flex-1 space-y-4 overflow-y-auto rounded-xl border bg-muted/20 p-4",children:j}),e[49]=j,e[50]=b):b=e[50];let N;e[51]!==k||e[52]!==S||e[53]!==C||e[54]!==L||e[55]!==t.status?(N=s.jsx("div",{className:"rounded-xl border bg-card p-4 shadow-sm",children:t.status==="CERRADO"?s.jsx("div",{className:"text-center text-sm text-muted-foreground",children:"Este ticket está cerrado. Reabra el ticket para responder."}):s.jsxs("form",{onSubmit:L,className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(ce,{placeholder:"Escriba su respuesta...",value:k.message,onChange:a=>C("message",a.target.value),className:"min-h-[80px] resize-none pr-12",required:!0}),s.jsxs("div",{className:"absolute right-2 bottom-2",children:[s.jsx(ne,{htmlFor:"msg-image",className:"block cursor-pointer rounded-full p-2 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",children:s.jsx(J,{className:"size-4"})}),s.jsx(le,{id:"msg-image",type:"file",className:"hidden",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",onChange:a=>C("image",a.target.files?a.target.files[0]:null)})]})]}),k.image&&s.jsxs("div",{className:"flex w-fit items-center gap-1 rounded bg-blue-50 px-2 py-1 text-xs text-blue-600",children:[s.jsx(J,{className:"size-3"}),"Imagen adjunta: ",k.image.name]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Comandancia vs Compañía"}),s.jsxs(v,{type:"submit",disabled:S,className:"gap-2",children:[s.jsx(de,{className:"size-4"}),"Responder"]})]})]})}),e[51]=k,e[52]=S,e[53]=C,e[54]=L,e[55]=t.status,e[56]=N):N=e[56];let y;e[57]!==g||e[58]!==b||e[59]!==N?(y=s.jsxs("div",{className:"mx-auto flex h-[calc(100vh-120px)] w-full max-w-5xl flex-col gap-6 p-4",children:[D,g,b,N]}),e[57]=g,e[58]=b,e[59]=N,e[60]=y):y=e[60];let T;return e[61]!==n||e[62]!==y||e[63]!==l?(T=s.jsxs(ie,{breadcrumbs:l,children:[n,y]}),e[61]=n,e[62]=y,e[63]=l,e[64]=T):T=e[64],T}function ue(i){return i.split("/").pop()}function xe(i){const e=i.split(".").pop()?.toLowerCase();return["jpg","jpeg","png","gif","webp"].includes(e||"")}function he(i){switch(i){case"ABIERTO":return s.jsx(w,{className:"bg-yellow-500",children:"Pendiente"});case"EN_PROCESO":return s.jsx(w,{className:"bg-blue-500",children:"En Proceso"});case"CERRADO":return s.jsx(w,{variant:"secondary",children:"Cerrado"});default:return s.jsx(w,{variant:"outline",children:i})}}export{De as default};
