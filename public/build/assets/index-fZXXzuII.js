import{c as rt,b as nt,r as Ae,u as Qe,j as t,H as ct,a as ot}from"./app-BOBspnt-.js";import{B as K}from"./badge-DrfcEP6J.js";import{B as X}from"./button-Di1XbPUP.js";import{C as Be}from"./checkbox-juppE8cW.js";import{e as dt,b as Ue,D as We,a as Je,f as Ke,c as Xe,d as Ye}from"./dialog-ReZnURLU.js";import{L as m}from"./label-C6BinEqh.js";import{S as Ze,a as et,b as tt,c as st,d as le}from"./select-CT-xYwsE.js";import{T as mt}from"./textarea-sowaydwO.js";import{A as ht}from"./app-layout-9l6tE_1t.js";import{f as pt}from"./format-CSQe5d3I.js";import{P as xt}from"./plus-BNc2IPm8.js";import{E as lt}from"./eye-MRoe3Rlj.js";/* empty css            */import"./index-D4ApCw5w.js";import"./index-C8ghYhS1.js";import"./index-CZ3UvfYP.js";import"./check-vR_3gxU-.js";import"./chevron-down-CKj7OiL3.js";import"./index-C4J_hXM0.js";import"./shield-DVba0A4o.js";function Pt(n){const e=rt.c(139),{issues:h,vehicles:Re}=n,{auth:d}=nt().props,[De,Le]=Ae.useState(!1),[qe,Ie]=Ae.useState(!1),[Y,Ge]=Ae.useState(null);let ie;e[0]===Symbol.for("react.memo_cache_sentinel")?(ie={is_stopped:!1,sent_to_hq:!1,sent_to_workshop:!1},e[0]=ie):ie=e[0];const{data:c,setData:i,put:Fe,processing:Me,reset:Te}=Qe(ie);let ae;e[1]===Symbol.for("react.memo_cache_sentinel")?(ae={vehicle_id:"",description:"",severity:"Low",date:pt(new Date,"yyyy-MM-dd")},e[1]=ae):ae=e[1];const{data:a,setData:r,post:Ve,processing:Ee,errors:o,reset:He}=Qe(ae);let re;e[2]!==Ve||e[3]!==He?(re=s=>{s.preventDefault(),Ve("/vehicles/incidents",{onSuccess:()=>{Le(!1),He()}})},e[2]=Ve,e[3]=He,e[4]=re):re=e[4];const Pe=re;let ne;e[5]!==Fe||e[6]!==Te||e[7]!==Y?(ne=s=>{s.preventDefault(),Y&&Fe(`/vehicles/incidents/${Y.id}`,{onSuccess:()=>{Ie(!1),Te(),Ge(null)}})},e[5]=Fe,e[6]=Te,e[7]=Y,e[8]=ne):ne=e[8];const Oe=ne;let ce;e[9]!==i?(ce=s=>{Ge(s),i({is_stopped:s.is_stopped,sent_to_hq:s.sent_to_hq,sent_to_workshop:s.sent_to_workshop}),Ie(!0)},e[9]=i,e[10]=ce):ce=e[10];const Z=ce,$e=vt,it=ut,ee=d.user.role==="capitan"||d.user.role==="admin"||d.user.company==="Comandancia",te=d.user.role==="mechanic"||d.user.role==="admin",se=d.user.company==="Comandancia"||d.user.role==="admin";let oe,de;e[11]===Symbol.for("react.memo_cache_sentinel")?(oe=[{title:"Material Mayor",href:"/vehicles/dashboard"},{title:"Incidencias",href:"/vehicles/incidents"}],de=t.jsx(ct,{title:"Registro de Incidencias"}),e[11]=oe,e[12]=de):(oe=e[11],de=e[12]);let me;e[13]===Symbol.for("react.memo_cache_sentinel")?(me=t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Registro de Incidencias"}),t.jsx("p",{className:"text-muted-foreground",children:"Reporte y seguimiento de problemas mecánicos."})]}),e[13]=me):me=e[13];let he;e[14]===Symbol.for("react.memo_cache_sentinel")?(he=t.jsx(dt,{asChild:!0,children:t.jsxs(X,{children:[t.jsx(xt,{className:"mr-2 h-4 w-4"})," Nueva Incidencia"]})}),e[14]=he):he=e[14];let pe;e[15]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsxs(Ue,{children:[t.jsx(We,{children:"Reportar Incidencia"}),t.jsx(Je,{children:"Ingrese los detalles del problema detectado en la unidad."})]}),e[15]=pe):pe=e[15];let xe;e[16]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsx(m,{htmlFor:"vehicle",children:"Vehículo"}),e[16]=xe):xe=e[16];let p;e[17]!==r?(p=s=>r("vehicle_id",s),e[17]=r,e[18]=p):p=e[18];const at=a.vehicle_id;let fe;e[19]===Symbol.for("react.memo_cache_sentinel")?(fe=t.jsx(et,{children:t.jsx(tt,{placeholder:"Seleccione unidad"})}),e[19]=fe):fe=e[19];let x;e[20]!==Re?(x=Re.map(ft),e[20]=Re,e[21]=x):x=e[21];let f;e[22]!==x?(f=t.jsx(st,{children:x}),e[22]=x,e[23]=f):f=e[23];let u;e[24]!==a.vehicle_id||e[25]!==p||e[26]!==f?(u=t.jsxs(Ze,{onValueChange:p,value:at,children:[fe,f]}),e[24]=a.vehicle_id,e[25]=p,e[26]=f,e[27]=u):u=e[27];let v;e[28]!==o.vehicle_id?(v=o.vehicle_id&&t.jsx("p",{className:"text-sm text-destructive",children:o.vehicle_id}),e[28]=o.vehicle_id,e[29]=v):v=e[29];let j;e[30]!==u||e[31]!==v?(j=t.jsxs("div",{className:"grid gap-2",children:[xe,u,v]}),e[30]=u,e[31]=v,e[32]=j):j=e[32];let ue;e[33]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx(m,{htmlFor:"severity",children:"Severidad"}),e[33]=ue):ue=e[33];let _;e[34]!==r?(_=s=>r("severity",s),e[34]=r,e[35]=_):_=e[35];let ve;e[36]===Symbol.for("react.memo_cache_sentinel")?(ve=t.jsx(et,{children:t.jsx(tt,{placeholder:"Nivel de Gravedad"})}),e[36]=ve):ve=e[36];let je;e[37]===Symbol.for("react.memo_cache_sentinel")?(je=t.jsxs(st,{children:[t.jsx(le,{value:"Low",children:"Baja (Observación)"}),t.jsx(le,{value:"Medium",children:"Media (Reparación necesaria)"}),t.jsx(le,{value:"High",children:"Alta (Riesgo operativo)"}),t.jsx(le,{value:"Critical",children:"Crítica (Inoperativo)"})]}),e[37]=je):je=e[37];let g;e[38]!==a.severity||e[39]!==_?(g=t.jsxs("div",{className:"grid gap-2",children:[ue,t.jsxs(Ze,{onValueChange:_,value:a.severity,children:[ve,je]})]}),e[38]=a.severity,e[39]=_,e[40]=g):g=e[40];let _e;e[41]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsx(m,{htmlFor:"date",children:"Fecha Detección"}),e[41]=_e):_e=e[41];let b;e[42]!==r?(b=s=>r("date",s.target.value),e[42]=r,e[43]=b):b=e[43];let N;e[44]!==a.date||e[45]!==b?(N=t.jsxs("div",{className:"grid gap-2",children:[_e,t.jsx(Input,{type:"date",value:a.date,onChange:b})]}),e[44]=a.date,e[45]=b,e[46]=N):N=e[46];let ge;e[47]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsx(m,{htmlFor:"description",children:"Descripción del Problema"}),e[47]=ge):ge=e[47];let y;e[48]!==r?(y=s=>r("description",s.target.value),e[48]=r,e[49]=y):y=e[49];let w;e[50]!==a.description||e[51]!==y?(w=t.jsx(mt,{id:"description",value:a.description,onChange:y,placeholder:"Detalle el problema, observaciones, etc."}),e[50]=a.description,e[51]=y,e[52]=w):w=e[52];let S;e[53]!==o.description?(S=o.description&&t.jsx("p",{className:"text-sm text-destructive",children:o.description}),e[53]=o.description,e[54]=S):S=e[54];let C;e[55]!==w||e[56]!==S?(C=t.jsxs("div",{className:"grid gap-2",children:[ge,w,S]}),e[55]=w,e[56]=S,e[57]=C):C=e[57];let k;e[58]!==j||e[59]!==g||e[60]!==N||e[61]!==C?(k=t.jsxs("div",{className:"grid gap-4 py-4",children:[j,g,N,C]}),e[58]=j,e[59]=g,e[60]=N,e[61]=C,e[62]=k):k=e[62];let R;e[63]!==Ee?(R=t.jsx(Ke,{children:t.jsx(X,{type:"submit",disabled:Ee,children:"Reportar"})}),e[63]=Ee,e[64]=R):R=e[64];let D;e[65]!==Pe||e[66]!==k||e[67]!==R?(D=t.jsx(Xe,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:Pe,children:[pe,k,R]})}),e[65]=Pe,e[66]=k,e[67]=R,e[68]=D):D=e[68];let q;e[69]!==De||e[70]!==D?(q=t.jsxs(Ye,{open:De,onOpenChange:Le,children:[he,D]}),e[69]=De,e[70]=D,e[71]=q):q=e[71];let be;e[72]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsx(We,{children:"Revisión de Incidencia"}),e[72]=be):be=e[72];const ze=Y?.vehicle.name;let I;e[73]!==ze?(I=t.jsxs(Ue,{children:[be,t.jsxs(Je,{children:["Determinar acciones a seguir para"," ",ze]})]}),e[73]=ze,e[74]=I):I=e[74];let F;e[75]!==i?(F=s=>i("is_stopped",s),e[75]=i,e[76]=F):F=e[76];let M;e[77]!==c.is_stopped||e[78]!==F?(M=t.jsx(Be,{id:"review_is_stopped",checked:c.is_stopped,onCheckedChange:F}),e[77]=c.is_stopped,e[78]=F,e[79]=M):M=e[79];let Ne;e[80]===Symbol.for("react.memo_cache_sentinel")?(Ne=t.jsx(m,{htmlFor:"review_is_stopped",className:"font-bold text-destructive",children:"Material Fuera de Servicio"}),e[80]=Ne):Ne=e[80];let T;e[81]!==M?(T=t.jsxs("div",{className:"flex items-center space-x-2",children:[M,Ne]}),e[81]=M,e[82]=T):T=e[82];let ye;e[83]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx("h4",{className:"text-sm font-medium",children:"Notificaciones"}),e[83]=ye):ye=e[83];let V;e[84]!==i?(V=s=>i("sent_to_hq",s),e[84]=i,e[85]=V):V=e[85];let E;e[86]!==c.sent_to_hq||e[87]!==V?(E=t.jsx(Be,{id:"sent_to_hq",checked:c.sent_to_hq,onCheckedChange:V}),e[86]=c.sent_to_hq,e[87]=V,e[88]=E):E=e[88];let we;e[89]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx(m,{htmlFor:"sent_to_hq",children:"Reportar a Comandancia"}),e[89]=we):we=e[89];let H;e[90]!==E?(H=t.jsxs("div",{className:"flex items-center space-x-2",children:[E,we]}),e[90]=E,e[91]=H):H=e[91];let P;e[92]!==i?(P=s=>i("sent_to_workshop",s),e[92]=i,e[93]=P):P=e[93];let O;e[94]!==c.sent_to_workshop||e[95]!==P?(O=t.jsx(Be,{id:"sent_to_workshop",checked:c.sent_to_workshop,onCheckedChange:P}),e[94]=c.sent_to_workshop,e[95]=P,e[96]=O):O=e[96];let Se;e[97]===Symbol.for("react.memo_cache_sentinel")?(Se=t.jsx(m,{htmlFor:"sent_to_workshop",children:"Reportar a Taller Mecánico"}),e[97]=Se):Se=e[97];let z;e[98]!==O?(z=t.jsxs("div",{className:"flex items-center space-x-2",children:[O,Se]}),e[98]=O,e[99]=z):z=e[99];let A;e[100]!==H||e[101]!==z?(A=t.jsxs("div",{className:"space-y-2 border-t pt-4",children:[ye,H,z]}),e[100]=H,e[101]=z,e[102]=A):A=e[102];let B;e[103]!==T||e[104]!==A?(B=t.jsxs("div",{className:"grid gap-4 py-4",children:[T,A]}),e[103]=T,e[104]=A,e[105]=B):B=e[105];let L;e[106]!==Me?(L=t.jsx(Ke,{children:t.jsx(X,{type:"submit",disabled:Me,children:"Guardar Revisión"})}),e[106]=Me,e[107]=L):L=e[107];let G;e[108]!==Oe||e[109]!==I||e[110]!==B||e[111]!==L?(G=t.jsx(Xe,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:Oe,children:[I,B,L]})}),e[108]=Oe,e[109]=I,e[110]=B,e[111]=L,e[112]=G):G=e[112];let $;e[113]!==qe||e[114]!==G?($=t.jsx(Ye,{open:qe,onOpenChange:Ie,children:G}),e[113]=qe,e[114]=G,e[115]=$):$=e[115];let Q;e[116]!==q||e[117]!==$?(Q=t.jsxs("div",{className:"flex items-center justify-between",children:[me,q,$]}),e[116]=q,e[117]=$,e[118]=Q):Q=e[118];let Ce;e[119]===Symbol.for("react.memo_cache_sentinel")?(Ce=t.jsx("thead",{className:"[&_tr]:border-b",children:t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:[t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Fecha"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Unidad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Gravedad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Descripción"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Estado"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Reportado Por"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Acciones"})]})}),e[119]=Ce):Ce=e[119];let U;if(e[120]!==ee||e[121]!==se||e[122]!==te||e[123]!==h.data||e[124]!==Z){let s;e[126]!==ee||e[127]!==se||e[128]!==te||e[129]!==Z?(s=l=>t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50",children:[t.jsx("td",{className:"p-4 align-middle",children:l.date}),t.jsx("td",{className:"p-4 align-middle font-medium",children:l.vehicle.name}),t.jsx("td",{className:"p-4 align-middle",children:t.jsx(K,{variant:it(l.severity),children:l.severity})}),t.jsx("td",{className:"max-w-[300px] truncate p-4 align-middle",children:l.description}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[l.is_stopped&&t.jsx(K,{variant:"destructive",className:"w-fit",children:"Detenido"}),!l.reviewed_at&&t.jsx(K,{variant:"outline",className:"w-fit border-yellow-500 text-yellow-600",children:"Pendiente Revisión"}),l.reviewed_at&&t.jsx(K,{variant:"outline",className:"w-fit border-blue-500 text-blue-600",children:"Revisado"}),l.sent_to_hq&&t.jsx(K,{variant:l.hq_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.hq_read_at?"Visto Comandancia":"Enviado Comandancia"}),l.sent_to_workshop&&t.jsx(K,{variant:l.workshop_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.workshop_read_at?"Visto Taller":"Enviado Taller"})]})}),t.jsx("td",{className:"p-4 align-middle",children:l.reporter?.name||"Desconocido"}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex gap-2",children:[ee&&t.jsx(X,{size:"sm",variant:"outline",onClick:()=>Z(l),children:"Revisar"}),te&&l.sent_to_workshop&&!l.workshop_read_at&&t.jsxs(X,{size:"sm",variant:"ghost",onClick:()=>$e(l),title:"Marcar como Visto",children:[t.jsx(lt,{className:"mr-1 size-4"})," ","Taller"]}),se&&l.sent_to_hq&&!l.hq_read_at&&t.jsxs(X,{size:"sm",variant:"ghost",onClick:()=>$e(l),title:"Marcar como Visto",children:[t.jsx(lt,{className:"mr-1 size-4"})," ","HQ"]})]})})]},l.id),e[126]=ee,e[127]=se,e[128]=te,e[129]=Z,e[130]=s):s=e[130],U=h.data.map(s),e[120]=ee,e[121]=se,e[122]=te,e[123]=h.data,e[124]=Z,e[125]=U}else U=e[125];let W;e[131]!==h.data.length?(W=h.data.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"p-4 text-center text-muted-foreground",children:"No hay incidencias registradas."})}),e[131]=h.data.length,e[132]=W):W=e[132];let J;e[133]!==U||e[134]!==W?(J=t.jsx("div",{className:"rounded-md border",children:t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsxs("table",{className:"w-full caption-bottom text-sm",children:[Ce,t.jsxs("tbody",{className:"[&_tr:last-child]:border-0",children:[U,W]})]})})}),e[133]=U,e[134]=W,e[135]=J):J=e[135];let ke;return e[136]!==Q||e[137]!==J?(ke=t.jsxs(ht,{breadcrumbs:oe,children:[de,t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[Q,J]})]}),e[136]=Q,e[137]=J,e[138]=ke):ke=e[138],ke}function ft(n){return t.jsx(le,{value:n.id.toString(),children:n.name},n.id)}function ut(n){switch(n){case"Critical":return"destructive";case"High":return"destructive";case"Medium":return"secondary";default:return"outline"}}function vt(n){ot.patch(`/vehicles/incidents/${n.id}/mark-read`,{},{preserveScroll:!0})}export{Pt as default};
