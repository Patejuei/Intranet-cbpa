import{c as ze,b as Be,u as Re,j as s,L as Ne,H as We}from"./app-C47ajvwZ.js";import{B as Ie}from"./badge-DZe8-Xs4.js";import{a as qe,B as Z,f as te}from"./button-DVWjdZ4N.js";import{b as j,C as ee,a as se,c as g}from"./card-CeHVsmD0.js";import{d as Ue,e as Ge,c as Je,b as Ke,D as Qe,a as Xe,f as Ye}from"./dialog-BCFDsY0J.js";import{I as $e}from"./input-CblF7ANJ.js";import{L as Me}from"./label-DqjRn-RE.js";import{u as Ze}from"./use-permissions-DOQFHan-.js";import{W as Fe,A as es,C as ss,F as ts}from"./app-layout-B6KaDQVR.js";import{C as Ae}from"./calendar-DughNSME.js";import{C as Oe}from"./circle-check-C2r5YENf.js";import{C as Pe}from"./circle-alert-BSe7YoKd.js";import{A as as}from"./arrow-left-CyoeRRHY.js";/* empty css            */import"./index-uxvNNlD4.js";import"./index-BtrKZ9Fe.js";import"./index-C4J_hXM0.js";import"./shield-ip1xpS6g.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],is=qe("DollarSign",ls);function Ms(a){const e=ze.c(155),{vehicle:t,totalMaintenanceCost:ae}=a,l=Be().props,{canEdit:le}=Ze(),r=t.issues?.[0],i=t.maintenances?.[0],Ve=ps,be=hs,ve=t.technical_review_expires_at||"",ye=t.circulation_permit_expires_at||"",we=t.insurance_expires_at||"";let de;e[0]!==ve||e[1]!==ye||e[2]!==we?(de={technical_review_expires_at:ve,circulation_permit_expires_at:ye,insurance_expires_at:we},e[0]=ve,e[1]=ye,e[2]=we,e[3]=de):de=e[3];const{data:u,setData:f,patch:ke,processing:ie,errors:c}=Re(de);let oe;e[4]!==ke||e[5]!==t.id?(oe=ce=>{ce.preventDefault(),ke(`/vehicles/${t.id}/documents`,{onSuccess:xs})},e[4]=ke,e[5]=t.id,e[6]=oe):oe=e[6];const re=oe;let _,N,b,n,d,v,o,y,w,m,k,x,h,C,S,D,p;if(e[7]!==l.auth||e[8]!==le||e[9]!==u||e[10]!==c||e[11]!==ie||e[12]!==f||e[13]!==re||e[14]!==t.circulation_permit_expires_at||e[15]!==t.company||e[16]!==t.id||e[17]!==t.insurance_expires_at||e[18]!==t.make||e[19]!==t.model||e[20]!==t.name||e[21]!==t.plate||e[22]!==t.status||e[23]!==t.technical_review_expires_at||e[24]!==t.year){const ce=[{label:"Revisión Técnica",date:t.technical_review_expires_at,check:be(t.technical_review_expires_at)},{label:"Permiso de Circulación",date:t.circulation_permit_expires_at,check:be(t.circulation_permit_expires_at)},{label:"Seguro Obligatorio",date:t.insurance_expires_at,check:be(t.insurance_expires_at)}];b=es;let xe;e[42]===Symbol.for("react.memo_cache_sentinel")?(xe={title:"Material Mayor",href:"/vehicles/status"},e[42]=xe):xe=e[42];const Ce=`/vehicles/status/${t.id}`;e[43]!==Ce||e[44]!==t.name?(x=[xe,{title:t.name,href:Ce}],e[43]=Ce,e[44]=t.name,e[45]=x):x=e[45];const Se=`Detalle ${t.name}`;e[46]!==Se?(h=s.jsx(We,{title:Se}),e[46]=Se,e[47]=h):h=e[47],w="mx-auto flex w-full max-w-7xl flex-col gap-6 p-4";let he;e[48]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx(Z,{variant:"ghost",size:"icon",asChild:!0,children:s.jsx(Ne,{href:"/vehicles/status",children:s.jsx(as,{className:"h-5 w-5"})})}),e[48]=he):he=e[48];const He=t.name,De=Ve(t.status),Te=t.status==="Operative"?"En Servicio":t.status==="Workshop"?"En Taller":"Fuera de Servicio";let H;e[49]!==De||e[50]!==Te?(H=s.jsx(Ie,{className:De,children:Te}),e[49]=De,e[50]=Te,e[51]=H):H=e[51];let z;e[52]!==H||e[53]!==t.name?(z=s.jsxs("h1",{className:"flex items-center gap-3 text-2xl font-bold",children:[He,H]}),e[52]=H,e[53]=t.name,e[54]=z):z=e[54];let B;e[55]!==t.company||e[56]!==t.make||e[57]!==t.model?(B=s.jsxs("p",{className:"text-muted-foreground",children:[t.company," - ",t.make," ",t.model]}),e[55]=t.company,e[56]=t.make,e[57]=t.model,e[58]=B):B=e[58];let R;e[59]!==z||e[60]!==B?(R=s.jsxs("div",{className:"flex items-center gap-4",children:[he,s.jsxs("div",{children:[z,B]})]}),e[59]=z,e[60]=B,e[61]=R):R=e[61];const Ee=`/vehicles/logs?vehicle_id=${t.id}`;let pe;e[62]===Symbol.for("react.memo_cache_sentinel")?(pe=s.jsx(ss,{className:"mr-2 h-4 w-4"}),e[62]=pe):pe=e[62];let W;e[63]!==Ee?(W=s.jsx(Z,{variant:"outline",asChild:!0,children:s.jsxs(Ne,{href:Ee,children:[pe,"Ver Bitácora"]})}),e[63]=Ee,e[64]=W):W=e[64];const Le=`/vehicles/checklists?vehicle_id=${t.id}`;let ue;e[65]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx(ts,{className:"mr-2 h-4 w-4"}),e[65]=ue):ue=e[65];let q;e[66]!==Le?(q=s.jsx(Z,{variant:"outline",asChild:!0,children:s.jsxs(Ne,{href:Le,children:[ue,"Ver Checklists"]})}),e[66]=Le,e[67]=q):q=e[67];let U;e[68]!==l.auth||e[69]!==t.id?(U=l.auth?.user&&(l.auth.user.role==="admin"||l.auth.user.role==="capitan")&&s.jsx(Z,{asChild:!0,children:s.jsxs(Ne,{href:`/vehicles/${t.id}/edit`,children:[s.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Editar Unidad"]})}),e[68]=l.auth,e[69]=t.id,e[70]=U):U=e[70];let G;e[71]!==le||e[72]!==u||e[73]!==c||e[74]!==ie||e[75]!==f||e[76]!==re?(G=le("vehicles.status")&&s.jsxs(Ue,{children:[s.jsx(Ge,{asChild:!0,children:s.jsxs(Z,{variant:"secondary",children:[s.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Actualizar Vencimientos"]})}),s.jsxs(Je,{children:[s.jsxs(Ke,{children:[s.jsx(Qe,{children:"Actualizar Documentación"}),s.jsx(Xe,{children:"Modifique las fechas de vencimiento de los documentos del vehículo."})]}),s.jsxs("form",{onSubmit:re,children:[s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Me,{htmlFor:"technical_review",children:"Revisión Técnica"}),s.jsx($e,{type:"date",value:u.technical_review_expires_at,onChange:ne=>f("technical_review_expires_at",ne.target.value)}),c.technical_review_expires_at&&s.jsx("span",{className:"text-sm text-destructive",children:c.technical_review_expires_at})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Me,{htmlFor:"circulation_permit",children:"Permiso de Circulación"}),s.jsx($e,{type:"date",value:u.circulation_permit_expires_at,onChange:ne=>f("circulation_permit_expires_at",ne.target.value)}),c.circulation_permit_expires_at&&s.jsx("span",{className:"text-sm text-destructive",children:c.circulation_permit_expires_at})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Me,{htmlFor:"insurance",children:"Seguro Obligatorio"}),s.jsx($e,{type:"date",value:u.insurance_expires_at,onChange:ne=>f("insurance_expires_at",ne.target.value)}),c.insurance_expires_at&&s.jsx("span",{className:"text-sm text-destructive",children:c.insurance_expires_at})]})]}),s.jsx(Ye,{children:s.jsx(Z,{type:"submit",disabled:ie,children:"Guardar Cambios"})})]})]})]}),e[71]=le,e[72]=u,e[73]=c,e[74]=ie,e[75]=f,e[76]=re,e[77]=G):G=e[77];let J;e[78]!==W||e[79]!==q||e[80]!==U||e[81]!==G?(J=s.jsxs("div",{className:"flex flex-wrap gap-2",children:[W,q,U,G]}),e[78]=W,e[79]=q,e[80]=U,e[81]=G,e[82]=J):J=e[82],e[83]!==R||e[84]!==J?(m=s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[R,J]}),e[83]=R,e[84]=J,e[85]=m):m=e[85],k=ce.some(ms)&&s.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:ce.map(os)}),y="grid grid-cols-1 gap-6 md:grid-cols-3",N=j,v="md:col-span-2",e[86]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(ee,{children:s.jsx(se,{children:"Información del Vehículo"})}),e[86]=o):o=e[86],_=g,D="space-y-4";let fe;e[87]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Patente"}),e[87]=fe):fe=e[87];let K;e[88]!==t.plate?(K=s.jsxs("div",{children:[fe,s.jsx("p",{className:"text-lg font-semibold",children:t.plate})]}),e[88]=t.plate,e[89]=K):K=e[89];let je;e[90]===Symbol.for("react.memo_cache_sentinel")?(je=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Año"}),e[90]=je):je=e[90];let Q;e[91]!==t.year?(Q=s.jsxs("div",{children:[je,s.jsx("p",{className:"text-lg font-semibold",children:t.year})]}),e[91]=t.year,e[92]=Q):Q=e[92];let ge;e[93]===Symbol.for("react.memo_cache_sentinel")?(ge=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Marca"}),e[93]=ge):ge=e[93];let X;e[94]!==t.make?(X=s.jsxs("div",{children:[ge,s.jsx("p",{className:"text-lg font-semibold",children:t.make})]}),e[94]=t.make,e[95]=X):X=e[95];let _e;e[96]===Symbol.for("react.memo_cache_sentinel")?(_e=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Modelo"}),e[96]=_e):_e=e[96];let Y;e[97]!==t.model?(Y=s.jsxs("div",{children:[_e,s.jsx("p",{className:"text-lg font-semibold",children:t.model})]}),e[97]=t.model,e[98]=Y):Y=e[98],e[99]!==K||e[100]!==Q||e[101]!==X||e[102]!==Y?(p=s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[K,Q,X,Y]}),e[99]=K,e[100]=Q,e[101]=X,e[102]=Y,e[103]=p):p=e[103],e[104]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx("hr",{className:"my-4"}),d=s.jsx("h3",{className:"mb-2 font-medium",children:"Documentación"}),e[104]=n,e[105]=d):(n=e[104],d=e[105]),C="grid grid-cols-1 gap-4 sm:grid-cols-3",S=ce.map(ds),e[7]=l.auth,e[8]=le,e[9]=u,e[10]=c,e[11]=ie,e[12]=f,e[13]=re,e[14]=t.circulation_permit_expires_at,e[15]=t.company,e[16]=t.id,e[17]=t.insurance_expires_at,e[18]=t.make,e[19]=t.model,e[20]=t.name,e[21]=t.plate,e[22]=t.status,e[23]=t.technical_review_expires_at,e[24]=t.year,e[25]=_,e[26]=N,e[27]=b,e[28]=n,e[29]=d,e[30]=v,e[31]=o,e[32]=y,e[33]=w,e[34]=m,e[35]=k,e[36]=x,e[37]=h,e[38]=C,e[39]=S,e[40]=D,e[41]=p}else _=e[25],N=e[26],b=e[27],n=e[28],d=e[29],v=e[30],o=e[31],y=e[32],w=e[33],m=e[34],k=e[35],x=e[36],h=e[37],C=e[38],S=e[39],D=e[40],p=e[41];let T;e[106]!==C||e[107]!==S?(T=s.jsx("div",{className:C,children:S}),e[106]=C,e[107]=S,e[108]=T):T=e[108];let E;e[109]!==l.auth||e[110]!==ae?(E=l.auth?.user&&(l.auth.user.company==="Comandancia"||l.auth.user.role==="admin")&&s.jsxs("div",{className:"mt-4 rounded-md bg-blue-50 p-4",children:[s.jsxs("div",{className:"mb-1 flex items-center gap-2 text-blue-800",children:[s.jsx(is,{className:"h-5 w-5"}),s.jsx("span",{className:"font-bold",children:"Inversión Total en Mantenimiento"})]}),s.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["$",(ae||0).toLocaleString("es-CL")]}),s.jsx("p",{className:"mt-1 text-xs text-blue-700",children:"Suma histórica de todas los trabajos realizados."})]}),e[109]=l.auth,e[110]=ae,e[111]=E):E=e[111];let L;e[112]!==_||e[113]!==n||e[114]!==d||e[115]!==T||e[116]!==E||e[117]!==D||e[118]!==p?(L=s.jsxs(_,{className:D,children:[p,n,d,T,E]}),e[112]=_,e[113]=n,e[114]=d,e[115]=T,e[116]=E,e[117]=D,e[118]=p,e[119]=L):L=e[119];let $;e[120]!==N||e[121]!==v||e[122]!==o||e[123]!==L?($=s.jsxs(N,{className:v,children:[o,L]}),e[120]=N,e[121]=v,e[122]=o,e[123]=L,e[124]=$):$=e[124];let M;e[125]!==t.status?(M=t.status==="Operative"&&s.jsxs(j,{className:"border-green-200 bg-green-50",children:[s.jsx(ee,{className:"pb-2",children:s.jsxs(se,{className:"flex items-center gap-2 text-green-800",children:[s.jsx(Oe,{className:"h-5 w-5"}),"Unidad Operativa"]})}),s.jsx(g,{children:s.jsx("p",{className:"text-sm text-green-700",children:"La unidad se encuentra operativa y disponible para el servicio."})})]}),e[125]=t.status,e[126]=M):M=e[126];let F;e[127]!==r||e[128]!==t.status?(F=t.status==="Out of Service"&&r&&s.jsxs(j,{className:"border-red-200 bg-red-50",children:[s.jsx(ee,{className:"pb-2",children:s.jsxs(se,{className:"flex items-center gap-2 text-red-800",children:[s.jsx(Pe,{className:"h-5 w-5"}),"Fuera de Servicio"]})}),s.jsxs(g,{className:"space-y-2",children:[s.jsx("p",{className:"text-sm font-medium text-red-900",children:"Motivo:"}),s.jsx("p",{className:"text-sm text-red-800",children:r.description}),s.jsxs("div",{className:"mt-2 flex gap-2 text-xs text-red-700",children:[s.jsx(Ae,{className:"h-3 w-3"})," ",r.date?te(r.date):te(r.created_at)]})]})]}),e[127]=r,e[128]=t.status,e[129]=F):F=e[129];let A;e[130]!==r||e[131]!==i||e[132]!==t.status?(A=(t.status==="Workshop"||t.status==="Out of Service"&&!r&&i)&&(i?s.jsxs(j,{className:"border-yellow-200 bg-yellow-50",children:[s.jsx(ee,{className:"pb-2",children:s.jsxs(se,{className:"flex items-center gap-2 text-yellow-800",children:[s.jsx(Fe,{className:"h-5 w-5"}),"En Taller (",i.status==="Scheduled"?"Agendado":"En Proceso",")"]})}),s.jsxs(g,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:i.workshop_name}),s.jsx("p",{className:"text-sm text-yellow-800",children:i.description}),s.jsxs("div",{className:"mt-1 flex gap-2 text-xs text-yellow-700",children:[s.jsx(Ae,{className:"h-3 w-3"})," ","Ingreso:"," ",te(i.entry_date)]})]}),i.tasks&&i.tasks.length>0&&s.jsxs("div",{className:"rounded-md bg-white/50 p-3",children:[s.jsx("h4",{className:"mb-2 text-xs font-bold tracking-wider text-yellow-900 uppercase",children:"Tareas"}),s.jsx("div",{className:"space-y-2",children:i.tasks.map(ns)})]}),i.issues&&i.issues.length>0&&s.jsxs("div",{className:"rounded-md bg-white/50 p-3",children:[s.jsx("h4",{className:"mb-2 text-xs font-bold tracking-wider text-yellow-900 uppercase",children:"Incidencias Asociadas"}),s.jsx("ul",{className:"list-disc pl-4 text-sm text-slate-700",children:i.issues.map(cs)})]})]})]}):s.jsxs(j,{className:"border-yellow-200 bg-yellow-50",children:[s.jsx(ee,{className:"pb-2",children:s.jsxs(se,{className:"flex items-center gap-2 text-yellow-800",children:[s.jsx(Fe,{className:"h-5 w-5"}),"En Taller"]})}),s.jsx(g,{children:s.jsx("p",{className:"text-sm text-yellow-800",children:"No hay información detallada de la orden de trabajo."})})]})),e[130]=r,e[131]=i,e[132]=t.status,e[133]=A):A=e[133];let I;e[134]!==M||e[135]!==F||e[136]!==A?(I=s.jsxs("div",{className:"space-y-6",children:[M,F,A]}),e[134]=M,e[135]=F,e[136]=A,e[137]=I):I=e[137];let O;e[138]!==y||e[139]!==$||e[140]!==I?(O=s.jsxs("div",{className:y,children:[$,I]}),e[138]=y,e[139]=$,e[140]=I,e[141]=O):O=e[141];let P;e[142]!==t.maintenances?(P=t.maintenances&&t.maintenances.length>0&&s.jsxs(j,{children:[s.jsx(ee,{children:s.jsx(se,{children:"Historial de Órdenes de Trabajo"})}),s.jsx(g,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"border-b bg-muted/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-2 py-3 font-medium",children:"Fecha Ingreso"}),s.jsx("th",{className:"p-2 py-3 font-medium",children:"Taller"}),s.jsx("th",{className:"p-2 py-3 font-medium",children:"Trabajo"}),s.jsx("th",{className:"p-2 py-3 font-medium",children:"Estado"}),s.jsx("th",{className:"p-2 py-3 text-right font-medium",children:"Costo"})]})}),s.jsx("tbody",{children:t.maintenances.map(rs)})]})})})]}),e[142]=t.maintenances,e[143]=P):P=e[143];let V;e[144]!==w||e[145]!==m||e[146]!==k||e[147]!==O||e[148]!==P?(V=s.jsxs("div",{className:w,children:[m,k,O,P]}),e[144]=w,e[145]=m,e[146]=k,e[147]=O,e[148]=P,e[149]=V):V=e[149];let me;return e[150]!==b||e[151]!==x||e[152]!==h||e[153]!==V?(me=s.jsxs(b,{breadcrumbs:x,children:[h,V]}),e[150]=b,e[151]=x,e[152]=h,e[153]=V,e[154]=me):me=e[154],me}function rs(a){return s.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/20",children:[s.jsx("td",{className:"p-2 py-3",children:te(a.entry_date)}),s.jsx("td",{className:"p-2 py-3",children:a.workshop_name}),s.jsx("td",{className:"p-2 py-3",children:a.description}),s.jsx("td",{className:"p-2 py-3",children:s.jsx(Ie,{variant:"outline",className:["Finalizado","Entregado"].includes(a.status)?"border-green-200 bg-green-50 text-green-700":"border-yellow-200 bg-yellow-50 text-yellow-700",children:a.status})}),s.jsx("td",{className:"p-2 py-3 text-right",children:a.cost>0?`$${a.cost.toLocaleString("es-CL")}`:"-"})]},a.id)}function cs(a){return s.jsxs("li",{children:[a.description,a.status==="Resolved"&&s.jsx("span",{className:"ml-2 text-xs font-bold text-green-600",children:"(Solucionado)"})]},a.id)}function ns(a){return s.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[a.is_completed?s.jsx(Oe,{className:"mt-0.5 h-4 w-4 text-green-600"}):s.jsx("div",{className:"mt-0.5 h-4 w-4 rounded-full border-2 border-slate-300"}),s.jsx("span",{className:a.is_completed?"text-slate-700 line-through opacity-70":"font-medium text-slate-800",children:a.description})]},a.id)}function ds(a,e){return s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:a.label}),s.jsx("p",{className:"text-sm font-semibold",children:a.date?te(a.date):"No registrado"})]},e)}function os(a,e){return!a.check||a.check.status==="ok"?null:s.jsx(j,{className:`border-l-4 ${a.check.status==="expired"?"border-l-red-500 bg-red-50":"border-l-yellow-500 bg-yellow-50"}`,children:s.jsx(g,{className:"pt-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Pe,{className:`h-5 w-5 ${a.check.status==="expired"?"text-red-600":"text-yellow-600"}`}),s.jsxs("div",{children:[s.jsxs("p",{className:`font-semibold ${a.check.status==="expired"?"text-red-700":"text-yellow-700"}`,children:[a.label," ",a.check.status==="expired"?"Vencido":"Por Vencer"]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vence:"," ",te(a.date)," ",s.jsxs("span",{className:"font-medium",children:["(",Math.abs(a.check.days)," ","días"," ",a.check.status==="expired"?"atrasado":"restantes",")"]})]})]})]})})},e)}function ms(a){return a.check?.status==="expired"||a.check?.status==="warning"}function xs(){}function hs(a){if(!a)return null;const e=new Date(a),t=new Date,ae=e.getTime()-t.getTime(),l=Math.ceil(ae/864e5);return l<0?{status:"expired",days:l}:l<=30?{status:"warning",days:l}:{status:"ok",days:l}}function ps(a){switch(a){case"Operative":return"bg-green-100 text-green-800";case"Workshop":return"bg-yellow-100 text-yellow-800";case"Out of Service":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}export{Ms as default};
