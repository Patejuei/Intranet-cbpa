import{r as I,j as t,c as V,u as Ce,H as Te,a as Se}from"./app-CGuCfgbg.js";import{B as ke}from"./badge-DjUDnTMd.js";import{c as G,B as le,f as we}from"./button-D65nKyRz.js";import{b as re,C as ne,a as ce,d as Fe,c as oe}from"./card-D3-mtHTa.js";import{I as f}from"./input-Cres2N1d.js";import{L as p}from"./label-DIhg13Fn.js";import{S as Z,a as ee,b as te,c as se,d as v}from"./select-eF6aVqKn.js";import{S as Ie}from"./switch-DzP6S3R9.js";import{c as Ve,a as ae,P as Ae,b as De}from"./index-Cq7Q3MAY.js";import{J as he,L as Me,K as Ee,u as Re,d as Le,A as Pe}from"./app-layout-u9Q5DKjD.js";import{P as z}from"./index-CUc2K9e4.js";import{T as $e}from"./textarea-DIcnwD8F.js";import{u as Be}from"./use-permissions-CSY_Jv43.js";import{f as He}from"./format-CSQe5d3I.js";/* empty css            */import"./index-j9aIAwFT.js";import"./check-_Go1bDRb.js";import"./index-q7GIQJN5.js";import"./shield-7FbujOzr.js";var O="Tabs",[Ke,bt]=Ve(O,[he]),ue=he(),[Ge,ie]=Ke(O),xe=I.forwardRef((s,e)=>{const{__scopeTabs:i,value:a,onValueChange:l,defaultValue:r,orientation:m="horizontal",dir:x,activationMode:d="automatic",...c}=s,u=Re(x),[h,o]=De({prop:a,onChange:l,defaultProp:r??"",caller:O});return t.jsx(Ge,{scope:i,baseId:Le(),value:h,onValueChange:o,orientation:m,dir:u,activationMode:d,children:t.jsx(z.div,{dir:u,"data-orientation":m,...c,ref:e})})});xe.displayName=O;var pe="TabsList",fe=I.forwardRef((s,e)=>{const{__scopeTabs:i,loop:a=!0,...l}=s,r=ie(pe,i),m=ue(i);return t.jsx(Ee,{asChild:!0,...m,orientation:r.orientation,dir:r.dir,loop:a,children:t.jsx(z.div,{role:"tablist","aria-orientation":r.orientation,...l,ref:e})})});fe.displayName=pe;var ve="TabsTrigger",je=I.forwardRef((s,e)=>{const{__scopeTabs:i,value:a,disabled:l=!1,...r}=s,m=ie(ve,i),x=ue(i),d=_e(m.baseId,a),c=Ne(m.baseId,a),u=a===m.value;return t.jsx(Me,{asChild:!0,...x,focusable:!l,active:u,children:t.jsx(z.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:d,...r,ref:e,onMouseDown:ae(s.onMouseDown,h=>{!l&&h.button===0&&h.ctrlKey===!1?m.onValueChange(a):h.preventDefault()}),onKeyDown:ae(s.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&m.onValueChange(a)}),onFocus:ae(s.onFocus,()=>{const h=m.activationMode!=="manual";!u&&!l&&h&&m.onValueChange(a)})})})});je.displayName=ve;var ge="TabsContent",be=I.forwardRef((s,e)=>{const{__scopeTabs:i,value:a,forceMount:l,children:r,...m}=s,x=ie(ge,i),d=_e(x.baseId,a),c=Ne(x.baseId,a),u=a===x.value,h=I.useRef(u);return I.useEffect(()=>{const o=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(o)},[]),t.jsx(Ae,{present:l||u,children:({present:o})=>t.jsx(z.div,{"data-state":u?"active":"inactive","data-orientation":x.orientation,role:"tabpanel","aria-labelledby":d,hidden:!o,id:c,tabIndex:0,...m,ref:e,style:{...s.style,animationDuration:h.current?"0s":void 0},children:o&&r})})});be.displayName=ge;function _e(s,e){return`${s}-trigger-${e}`}function Ne(s,e){return`${s}-content-${e}`}var ze=xe,Oe=fe,qe=je,Je=be;function Ue(s){const e=V.c(8);let i,a;e[0]!==s?({className:i,...a}=s,e[0]=s,e[1]=i,e[2]=a):(i=e[1],a=e[2]);let l;e[3]!==i?(l=G("flex flex-col gap-2",i),e[3]=i,e[4]=l):l=e[4];let r;return e[5]!==a||e[6]!==l?(r=t.jsx(ze,{"data-slot":"tabs",className:l,...a}),e[5]=a,e[6]=l,e[7]=r):r=e[7],r}function Qe(s){const e=V.c(8);let i,a;e[0]!==s?({className:i,...a}=s,e[0]=s,e[1]=i,e[2]=a):(i=e[1],a=e[2]);let l;e[3]!==i?(l=G("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",i),e[3]=i,e[4]=l):l=e[4];let r;return e[5]!==a||e[6]!==l?(r=t.jsx(Oe,{"data-slot":"tabs-list",className:l,...a}),e[5]=a,e[6]=l,e[7]=r):r=e[7],r}function de(s){const e=V.c(8);let i,a;e[0]!==s?({className:i,...a}=s,e[0]=s,e[1]=i,e[2]=a):(i=e[1],a=e[2]);let l;e[3]!==i?(l=G("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",i),e[3]=i,e[4]=l):l=e[4];let r;return e[5]!==a||e[6]!==l?(r=t.jsx(qe,{"data-slot":"tabs-trigger",className:l,...a}),e[5]=a,e[6]=l,e[7]=r):r=e[7],r}function me(s){const e=V.c(8);let i,a;e[0]!==s?({className:i,...a}=s,e[0]=s,e[1]=i,e[2]=a):(i=e[1],a=e[2]);let l;e[3]!==i?(l=G("flex-1 outline-none",i),e[3]=i,e[4]=l):l=e[4];let r;return e[5]!==a||e[6]!==l?(r=t.jsx(Je,{"data-slot":"tabs-content",className:l,...a}),e[5]=a,e[6]=l,e[7]=r):r=e[7],r}function _t(s){const e=V.c(56),{logs:i,vehicles:a,filters:l}=s,{canCreate:r}=Be();let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m=He(new Date,"yyyy-MM-dd"),e[0]=m):m=e[0];let x;e[1]===Symbol.for("react.memo_cache_sentinel")?(x={vehicle_id:"",start_km:"",end_km:"",departure_time:"",arrival_time:"",activity_type:"",destination:"",date:m,fuel_liters:"",fuel_coupon:"",has_fuel:!1,receipt:null,observations:""},e[1]=x):x=e[1];const{data:d,setData:c,post:u,processing:h,errors:o,reset:q}=Ce(x);let A;e[2]!==u||e[3]!==q?(A=n=>{n.preventDefault(),u("/vehicles/logs",{onSuccess:()=>q()})},e[2]=u,e[3]=q,e[4]=A):A=e[4];const J=A,ye=et;let D;e[5]!==c||e[6]!==a?(D=n=>{c("vehicle_id",n);const X=a.find(Y=>Y.id.toString()===n);X&&X.last_mileage&&c(Y=>({...Y,vehicle_id:n,start_km:String(X.last_mileage)}))},e[5]=c,e[6]=a,e[7]=D):D=e[7];const U=D;let M,E;e[8]===Symbol.for("react.memo_cache_sentinel")?(M=[{title:"Material Mayor",href:"/vehicles/dashboard"},{title:"Bitácora",href:"/vehicles/logs"}],E=t.jsx(Te,{title:"Bitácora de Máquinas"}),e[8]=M,e[9]=E):(M=e[8],E=e[9]);let R;e[10]===Symbol.for("react.memo_cache_sentinel")?(R=t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Bitácora del Material Mayor"}),t.jsx("p",{className:"text-muted-foreground",children:"Control de kilometraje y movimientos de las unidades."})]}),e[10]=R):R=e[10];const Q=r("vehicles.logs")?"register":"history";let j;e[11]!==r?(j=r("vehicles.logs")&&t.jsx(de,{value:"register",children:"Registrar Movimiento"}),e[11]=r,e[12]=j):j=e[12];let L;e[13]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx(de,{value:"history",children:"Ver Bitácoras"}),e[13]=L):L=e[13];let g;e[14]!==j?(g=t.jsxs(Qe,{className:"grid w-full grid-cols-2 md:w-[400px]",children:[j,L]}),e[14]=j,e[15]=g):g=e[15];let b;e[16]!==r||e[17]!==d||e[18]!==o||e[19]!==U||e[20]!==h||e[21]!==c||e[22]!==J||e[23]!==a?(b=r("vehicles.logs")&&t.jsx(me,{value:"register",children:t.jsxs(re,{children:[t.jsxs(ne,{children:[t.jsx(ce,{children:"Nueva Entrada de Bitácora"}),t.jsx(Fe,{children:"Registre la salida o movimiento de una unidad."})]}),t.jsx(oe,{children:t.jsxs("form",{onSubmit:J,className:"max-w-2xl space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"vehicle",children:"Vehículo"}),t.jsxs(Z,{onValueChange:U,value:d.vehicle_id,children:[t.jsx(ee,{children:t.jsx(te,{placeholder:"Seleccione unidad"})}),t.jsx(se,{children:a.map(Ze)})]}),o.vehicle_id&&t.jsx("p",{className:"text-sm text-destructive",children:o.vehicle_id})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"date",children:"Fecha"}),t.jsx(f,{type:"date",value:d.date,onChange:n=>c("date",n.target.value),onClick:Ye}),o.date&&t.jsx("p",{className:"text-sm text-destructive",children:o.date})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"start_km",children:"Kilometraje Inicio"}),t.jsx(f,{type:"number",value:d.start_km,onChange:n=>c("start_km",n.target.value)}),o.start_km&&t.jsx("p",{className:"text-sm text-destructive",children:o.start_km})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"end_km",children:"Kilometraje Fin (Opcional)"}),t.jsx(f,{type:"number",value:d.end_km,onChange:n=>c("end_km",n.target.value)}),o.end_km&&t.jsx("p",{className:"text-sm text-destructive",children:o.end_km})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(p,{htmlFor:"departure_time",children:["Hora Salida"," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(f,{type:"time",value:d.departure_time,onChange:n=>c("departure_time",n.target.value)})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(p,{htmlFor:"arrival_time",children:["Hora Llegada"," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(f,{type:"time",value:d.arrival_time,onChange:n=>c("arrival_time",n.target.value)})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"activity",children:"Tipo de Actividad"}),t.jsxs(Z,{onValueChange:n=>c("activity_type",n),value:d.activity_type,children:[t.jsx(ee,{children:t.jsx(te,{placeholder:"Seleccione tipo"})}),t.jsxs(se,{children:[t.jsx(v,{value:"Emergencia",children:"Emergencia"}),t.jsx(v,{value:"Academia",children:"Academia / Ejercicio"}),t.jsx(v,{value:"Tramite",children:"Trámite Administrativo"}),t.jsx(v,{value:"Taller",children:"Traslado a Taller"}),t.jsx(v,{value:"CargaCombustible",children:"Carga de Combustible"})]})]}),o.activity_type&&t.jsx("p",{className:"text-sm text-destructive",children:o.activity_type})]}),t.jsx("div",{className:"space-y-4 rounded-lg border p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(Ie,{id:"fuel-mode",checked:d.has_fuel,onCheckedChange:n=>c("has_fuel",n)}),t.jsx(p,{htmlFor:"fuel-mode",children:"¿Fue a Cargar Combustible?"})]})}),d.has_fuel&&t.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[t.jsx("h3",{className:"font-semibold",children:"Detalle de Carga"}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"fuel_liters",children:"Litros Cargados"}),t.jsx(f,{type:"number",step:"0.01",value:d.fuel_liters,onChange:n=>c("fuel_liters",n.target.value),placeholder:"0.0"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"fuel_coupon",children:"Nº Cupón / Vale"}),t.jsx(f,{value:d.fuel_coupon,onChange:n=>c("fuel_coupon",n.target.value),placeholder:"Nº Documento"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"receipt",children:"Fotografía Boleta/Vale"}),t.jsx(f,{id:"receipt",type:"file",accept:"image/*",onChange:n=>c("receipt",n.target.files?n.target.files[0]:null)})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"destination",children:"Destino / Detalle"}),t.jsx(f,{value:d.destination,onChange:n=>c("destination",n.target.value),placeholder:"Dirección o lugar de destino"}),o.destination&&t.jsx("p",{className:"text-sm text-destructive",children:o.destination})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(p,{htmlFor:"observations",children:"Observaciones (Opcional)"}),t.jsx($e,{value:d.observations,onChange:n=>c("observations",n.target.value),placeholder:"Detalle cualquier novedad o incidencia..."}),o.observations&&t.jsx("p",{className:"text-sm text-destructive",children:o.observations})]}),t.jsx(le,{type:"submit",disabled:h,children:"Registrar Movimiento"})]})})]})}),e[16]=r,e[17]=d,e[18]=o,e[19]=U,e[20]=h,e[21]=c,e[22]=J,e[23]=a,e[24]=b):b=e[24];let P;e[25]===Symbol.for("react.memo_cache_sentinel")?(P=t.jsx(ce,{children:"Historial de Bitácoras"}),e[25]=P):P=e[25];const W=l?.vehicle_id||"all";let $;e[26]===Symbol.for("react.memo_cache_sentinel")?($=t.jsx(ee,{className:"w-[200px]",children:t.jsx(te,{placeholder:"Filtrar por Vehículo"})}),e[26]=$):$=e[26];let B;e[27]===Symbol.for("react.memo_cache_sentinel")?(B=t.jsx(v,{value:"all",children:"Todos los Vehículos"}),e[27]=B):B=e[27];let _;e[28]!==a?(_=a.map(Xe),e[28]=a,e[29]=_):_=e[29];let N;e[30]!==_?(N=t.jsxs(se,{children:[B,_]}),e[30]=_,e[31]=N):N=e[31];let y;e[32]!==W||e[33]!==N?(y=t.jsxs(Z,{value:W,onValueChange:ye,children:[$,N]}),e[32]=W,e[33]=N,e[34]=y):y=e[34];let C;e[35]!==l.vehicle_id?(C=t.jsx(le,{variant:"outline",size:"sm",onClick:()=>{const n=l.vehicle_id||"all";window.location.href=`/vehicles/logs/export?vehicle_id=${n}`},children:"Exportar Excel"}),e[35]=l.vehicle_id,e[36]=C):C=e[36];let T;e[37]!==y||e[38]!==C?(T=t.jsxs(ne,{className:"flex flex-row items-center justify-between",children:[P,t.jsxs("div",{className:"flex w-[400px] items-center gap-2",children:[y,C]})]}),e[37]=y,e[38]=C,e[39]=T):T=e[39];let H;e[40]===Symbol.for("react.memo_cache_sentinel")?(H=t.jsx("thead",{className:"bg-muted/50",children:t.jsxs("tr",{className:"border-b",children:[t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Fecha"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Horas"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Unidad"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Actividad"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Destino"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Km Salida"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Km Llegada"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Conductor"})]})}),e[40]=H):H=e[40];let S;e[41]!==i.data?(S=i.data.map(We),e[41]=i.data,e[42]=S):S=e[42];let k;e[43]!==i.data.length?(k=i.data.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"p-4 text-center text-muted-foreground",children:"No hay registros."})}),e[43]=i.data.length,e[44]=k):k=e[44];let w;e[45]!==S||e[46]!==k?(w=t.jsx(oe,{children:t.jsx("div",{className:"overflow-x-auto rounded-md border",children:t.jsxs("table",{className:"w-full min-w-[800px] text-sm md:min-w-full",children:[H,t.jsxs("tbody",{children:[S,k]})]})})}),e[45]=S,e[46]=k,e[47]=w):w=e[47];let F;e[48]!==T||e[49]!==w?(F=t.jsx(me,{value:"history",children:t.jsxs(re,{children:[T,w]})}),e[48]=T,e[49]=w,e[50]=F):F=e[50];let K;return e[51]!==g||e[52]!==b||e[53]!==F||e[54]!==Q?(K=t.jsxs(Pe,{breadcrumbs:M,children:[E,t.jsxs("div",{className:"flex h-full flex-col gap-6 p-4",children:[R,t.jsxs(Ue,{defaultValue:Q,className:"w-full",children:[g,b,F]})]})]}),e[51]=g,e[52]=b,e[53]=F,e[54]=Q,e[55]=K):K=e[55],K}function We(s){return t.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[t.jsx("td",{className:"p-4",children:we(s.date)}),t.jsx("td",{className:"p-4",children:t.jsxs("div",{className:"flex flex-col text-xs",children:[t.jsxs("span",{children:["S:"," ",s.departure_time||"-"]}),t.jsxs("span",{children:["L:"," ",s.arrival_time||"-"]})]})}),t.jsx("td",{className:"p-4 font-medium",children:s.vehicle.name}),t.jsx("td",{className:"p-4",children:t.jsx(ke,{variant:"outline",children:s.activity_type})}),t.jsx("td",{className:"p-4",children:s.destination}),t.jsx("td",{className:"p-4",children:s.start_km}),t.jsx("td",{className:"p-4",children:s.end_km||"-"}),t.jsx("td",{className:"p-4",children:s.driver?.name})]},s.id)}function Xe(s){return t.jsx(v,{value:s.id.toString(),children:s.name},s.id)}function Ye(s){return s.currentTarget.showPicker()}function Ze(s){return t.jsx(v,{value:s.id.toString(),children:s.name},s.id)}function et(s){Se.get("/vehicles/logs",{vehicle_id:s==="all"?void 0:s},{preserveState:!0,preserveScroll:!0,replace:!0})}export{_t as default};
