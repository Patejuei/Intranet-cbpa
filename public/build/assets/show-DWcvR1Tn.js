import{c as us,u as js,b as _s,j as s,a as vs,H as gs}from"./app-tubDXl9A.js";import{B as ts}from"./badge-DNYLn2gU.js";import{a as bs,B as Q,f as as}from"./button-BWp4tIff.js";import{C as Ue,c as Xe,b as Ye,a as Ze}from"./card-iv82GoT0.js";import{C as ls}from"./checkbox-CZKI0vnL.js";import{I as es}from"./input-BEl5uqz5.js";import{L as U}from"./label-OD96AbTm.js";import{c as ks,S as ys,a as Ns,b as Cs,d as Ss}from"./select-B7wrKqYc.js";import{S as ss}from"./separator-CM5dHUrn.js";import{F as ws,A as Ts,W as Es}from"./app-layout-BcOV7iqU.js";import{C as Fs}from"./circle-check-QJwGD6Ia.js";import{P as Is}from"./printer-C8CE6Yuq.js";import{S as Rs}from"./save-CyLPvPGI.js";import{C as $s}from"./calendar-BadVibtx.js";/* empty css            */import"./index-CQqCNELc.js";import"./index-C2kOUDqc.js";import"./index-DKfK0T6v.js";import"./check-DvmiD8zK.js";import"./chevron-down-Cqb4XlFB.js";import"./index-C4J_hXM0.js";import"./shield-DulB0qDz.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ps=bs("Trash2",zs);function nt(o){const e=us.c(179),{maintenance:t}=o,is=t.status,ze=t.tentative_exit_date||"";let te;e[0]!==t.tasks?(te=t.tasks.map(As),e[0]=t.tasks,e[1]=te):te=e[1];const Pe=te;let ae;e[2]===Symbol.for("react.memo_cache_sentinel")?(ae=[],e[2]=ae):ae=e[2];let le;e[3]!==t.status||e[4]!==ze||e[5]!==Pe?(le={status:is,tentative_exit_date:ze,tasks:Pe,resolved_issue_ids:ae},e[3]=t.status,e[4]=ze,e[5]=Pe,e[6]=le):le=e[6];const{data:a,setData:r,put:De,processing:d}=js(le);let ie;e[7]===Symbol.for("react.memo_cache_sentinel")?(ie=["En Taller","Ingresado","Trabajando","En Espera de Repuestos","Pruebas Finales","Finalizado","Entregado"],e[7]=ie):ie=e[7];const rs=ie;let re;e[8]!==t.id||e[9]!==De?(re=l=>{l.preventDefault(),De(`/vehicles/workshop/${t.id}`)},e[8]=t.id,e[9]=De,e[10]=re):re=e[10];const Le=re;let ce;e[11]!==a.tasks||e[12]!==r?(ce=l=>{const c=[...a.tasks];c[l].is_completed=!c[l].is_completed,r("tasks",c)},e[11]=a.tasks,e[12]=r,e[13]=ce):ce=e[13];const X=ce;let ne;e[14]!==a.tasks||e[15]!==r?(ne=(l,c)=>{const n=[...a.tasks];n[l].cost=c?parseFloat(c):null,r("tasks",n)},e[14]=a.tasks,e[15]=r,e[16]=ne):ne=e[16];const Y=ne;let oe;e[17]!==a.tasks||e[18]!==r?(oe=(l,c)=>{const n=[...a.tasks];n[l].description=c,r("tasks",n)},e[17]=a.tasks,e[18]=r,e[19]=oe):oe=e[19];const Z=oe;let de;e[20]!==a.tasks||e[21]!==r?(de=()=>{r("tasks",[...a.tasks,{description:"",is_completed:!1,cost:null}])},e[20]=a.tasks,e[21]=r,e[22]=de):de=e[22];const Oe=de;let me;e[23]!==a.tasks||e[24]!==r?(me=l=>{const c=a.tasks.filter((n,se)=>se!==l);r("tasks",c)},e[23]=a.tasks,e[24]=r,e[25]=me):me=e[25];const ee=me;let he;e[26]!==a.resolved_issue_ids||e[27]!==r?(he=l=>{const c=a.resolved_issue_ids;c.includes(l)?r("resolved_issue_ids",c.filter(n=>n!==l)):r("resolved_issue_ids",[...c,l])},e[26]=a.resolved_issue_ids,e[27]=r,e[28]=he):he=e[28];const Ae=he,cs=a.tasks.reduce(Os,0);let fe;e[29]!==a.tasks?(fe=a.tasks.filter(Ls),e[29]=a.tasks,e[30]=fe):fe=e[30];const Me=fe.length,{auth:ns}=_s().props,i=ns.user.role==="maquinista",Ve=Ts;let xe,pe;e[31]===Symbol.for("react.memo_cache_sentinel")?(xe={title:"Panel Principal",href:"/dashboard"},pe={title:"Taller Mecánico",href:"/vehicles/workshop"},e[31]=xe,e[32]=pe):(xe=e[31],pe=e[32]);const Be=`Orden #${t.id}`,He=`/vehicles/workshop/${t.id}`;let m;e[33]!==Be||e[34]!==He?(m=[xe,pe,{title:Be,href:He}],e[33]=Be,e[34]=He,e[35]=m):m=e[35];const We=`Orden de Trabajo #${t.id}`;let h;e[36]!==We?(h=s.jsx(gs,{title:We}),e[36]=We,e[37]=h):h=e[37];const os="mx-auto flex w-full max-w-7xl flex-col gap-6 p-4";let ue;e[38]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx(Es,{className:"h-6 w-6"}),e[38]=ue):ue=e[38];let f;e[39]!==t.id?(f=s.jsxs("h1",{className:"flex items-center gap-2 text-2xl font-bold",children:[ue,"Orden de Trabajo #",t.id]}),e[39]=t.id,e[40]=f):f=e[40];let x;e[41]!==t.vehicle.company||e[42]!==t.vehicle.name||e[43]!==t.vehicle.plate?(x=s.jsxs("p",{className:"text-muted-foreground",children:[t.vehicle.name," -"," ",t.vehicle.plate," (",t.vehicle.company,")"]}),e[41]=t.vehicle.company,e[42]=t.vehicle.name,e[43]=t.vehicle.plate,e[44]=x):x=e[44];let p;e[45]!==f||e[46]!==x?(p=s.jsxs("div",{children:[f,x]}),e[45]=f,e[46]=x,e[47]=p):p=e[47];let u;e[48]!==t.id||e[49]!==t.status?(u=(t.status==="Finalizado"||t.status==="Entregado")&&s.jsx(Q,{variant:"outline",asChild:!0,className:"border-green-600 text-green-600 hover:bg-green-50",children:s.jsxs("a",{href:`/vehicles/workshop/${t.id}/print-exit`,target:"_blank",rel:"noopener noreferrer",children:[s.jsx(ws,{className:"mr-2 h-4 w-4"}),"Imprimir Salida"]})}),e[48]=t.id,e[49]=t.status,e[50]=u):u=e[50];const Ge=`/vehicles/workshop/${t.id}/print`;let je,_e,ve;e[51]===Symbol.for("react.memo_cache_sentinel")?(je=s.jsx(Is,{className:"mr-2 h-4 w-4"}),_e=s.jsx("span",{className:"hidden sm:inline",children:"Imprimir Orden"}),ve=s.jsx("span",{className:"sm:hidden",children:"Imprimir"}),e[51]=je,e[52]=_e,e[53]=ve):(je=e[51],_e=e[52],ve=e[53]);let j;e[54]!==Ge?(j=s.jsx(Q,{variant:"outline",asChild:!0,children:s.jsxs("a",{href:Ge,target:"_blank",rel:"noopener noreferrer",children:[je,_e,ve]})}),e[54]=Ge,e[55]=j):j=e[55];let _;e[56]!==Le||e[57]!==i||e[58]!==d?(_=!i&&s.jsxs(Q,{onClick:Le,disabled:d,children:[s.jsx(Rs,{className:"mr-2 h-4 w-4"}),"Guardar Cambios"]}),e[56]=Le,e[57]=i,e[58]=d,e[59]=_):_=e[59];let v;e[60]!==a||e[61]!==i||e[62]!==t.id||e[63]!==t.status||e[64]!==d?(v=!i&&t.status!=="Finalizado"&&t.status!=="Entregado"&&s.jsxs(Q,{variant:"destructive",onClick:()=>{confirm("¿Está seguro de finalizar el trabajo? Esto resolverá las incidencias marcadas y generará el documento de salida.")&&vs.put(`/vehicles/workshop/${t.id}`,{...a,status:"Finalizado"})},disabled:d,children:[s.jsx(Fs,{className:"mr-2 h-4 w-4"}),"Finalizar Trabajo"]}),e[60]=a,e[61]=i,e[62]=t.id,e[63]=t.status,e[64]=d,e[65]=v):v=e[65];let g;e[66]!==u||e[67]!==j||e[68]!==_||e[69]!==v?(g=s.jsxs("div",{className:"flex gap-2",children:[u,j,_,v]}),e[66]=u,e[67]=j,e[68]=_,e[69]=v,e[70]=g):g=e[70];let b;e[71]!==p||e[72]!==g?(b=s.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 md:flex-row md:items-center",children:[p,g]}),e[71]=p,e[72]=g,e[73]=b):b=e[73];const ds="grid grid-cols-1 gap-6 lg:grid-cols-3";let ge;e[74]===Symbol.for("react.memo_cache_sentinel")?(ge=s.jsx(Ue,{children:s.jsx(Ze,{children:"Estado y Fechas"})}),e[74]=ge):ge=e[74];let be;e[75]===Symbol.for("react.memo_cache_sentinel")?(be=s.jsx(U,{children:"Estado Actual"}),e[75]=be):be=e[75];let k;e[76]!==r?(k=l=>r("status",l),e[76]=r,e[77]=k):k=e[77];let ke;e[78]===Symbol.for("react.memo_cache_sentinel")?(ke=s.jsx(Ns,{children:s.jsx(Cs,{})}),e[78]=ke):ke=e[78];let ye;e[79]===Symbol.for("react.memo_cache_sentinel")?(ye=s.jsx(ks,{children:rs.map(Ds)}),e[79]=ye):ye=e[79];let y;e[80]!==a.status||e[81]!==i||e[82]!==k?(y=s.jsxs("div",{className:"space-y-2",children:[be,s.jsxs(ys,{value:a.status,onValueChange:k,disabled:i,children:[ke,ye]})]}),e[80]=a.status,e[81]=i,e[82]=k,e[83]=y):y=e[83];let Ne;e[84]===Symbol.for("react.memo_cache_sentinel")?(Ne=s.jsx(U,{children:"Fecha de Ingreso"}),e[84]=Ne):Ne=e[84];let Ce;e[85]===Symbol.for("react.memo_cache_sentinel")?(Ce=s.jsx($s,{className:"h-4 w-4"}),e[85]=Ce):Ce=e[85];let N;e[86]!==t.entry_date?(N=as(t.entry_date),e[86]=t.entry_date,e[87]=N):N=e[87];let C;e[88]!==N?(C=s.jsxs("div",{className:"space-y-2",children:[Ne,s.jsxs("div",{className:"flex items-center gap-2 rounded border bg-muted/50 p-2 text-sm",children:[Ce,N]})]}),e[88]=N,e[89]=C):C=e[89];let Se;e[90]===Symbol.for("react.memo_cache_sentinel")?(Se=s.jsx(U,{children:"Fecha Tentativa Salida"}),e[90]=Se):Se=e[90];let S;e[91]!==r?(S=l=>r("tentative_exit_date",l.target.value),e[91]=r,e[92]=S):S=e[92];let w;e[93]!==a.tentative_exit_date||e[94]!==i||e[95]!==S?(w=s.jsxs("div",{className:"space-y-2",children:[Se,s.jsx(es,{type:"date",value:a.tentative_exit_date,onChange:S,disabled:i})]}),e[93]=a.tentative_exit_date,e[94]=i,e[95]=S,e[96]=w):w=e[96];let we;e[97]===Symbol.for("react.memo_cache_sentinel")?(we=s.jsx(ss,{}),e[97]=we):we=e[97];let Te;e[98]===Symbol.for("react.memo_cache_sentinel")?(Te=s.jsx(U,{children:"Taller / Proveedor"}),e[98]=Te):Te=e[98];let T;e[99]!==t.workshop_name?(T=s.jsxs("div",{className:"space-y-2",children:[Te,s.jsx("p",{className:"font-medium",children:t.workshop_name})]}),e[99]=t.workshop_name,e[100]=T):T=e[100];let E;e[101]!==y||e[102]!==C||e[103]!==w||e[104]!==T?(E=s.jsxs(Ye,{children:[ge,s.jsxs(Xe,{className:"space-y-4",children:[y,C,w,we,T]})]}),e[101]=y,e[102]=C,e[103]=w,e[104]=T,e[105]=E):E=e[105];let Ee;e[106]===Symbol.for("react.memo_cache_sentinel")?(Ee=s.jsx(Ue,{children:s.jsx(Ze,{className:"text-base",children:"Incidencias Vinculadas"})}),e[106]=Ee):Ee=e[106];let F;e[107]!==a.resolved_issue_ids||e[108]!==i||e[109]!==t.issues||e[110]!==Ae?(F=t.issues.length===0?s.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay incidencias vinculadas."}):t.issues.map(l=>s.jsxs("div",{className:"flex items-start gap-2 rounded border p-2",children:[s.jsx(ls,{checked:l.status==="Resolved"||a.resolved_issue_ids.includes(l.id),disabled:i||l.status==="Resolved",onCheckedChange:()=>Ae(l.id)}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium",children:l.description}),s.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:as(l.date)}),s.jsx(ts,{variant:l.status==="Resolved"||a.resolved_issue_ids.includes(l.id)?"default":"secondary",children:l.status==="Resolved"?"Resuelto":a.resolved_issue_ids.includes(l.id)?"Marcado para Resolver":"Pendiente"})]})]})]},l.id)),e[107]=a.resolved_issue_ids,e[108]=i,e[109]=t.issues,e[110]=Ae,e[111]=F):F=e[111];let I;e[112]!==F?(I=s.jsxs(Ye,{children:[Ee,s.jsx(Xe,{className:"space-y-3",children:F})]}),e[112]=F,e[113]=I):I=e[113];let R;e[114]!==E||e[115]!==I?(R=s.jsxs("div",{className:"space-y-6 lg:col-span-1",children:[E,"// ... (Detalles del Ingreso Card remains same) ...",I]}),e[114]=E,e[115]=I,e[116]=R):R=e[116];const ms="space-y-6 lg:col-span-2",qe=Ye;let Fe;e[117]===Symbol.for("react.memo_cache_sentinel")?(Fe=s.jsx(Ze,{children:"Lista de Trabajos y Costos"}),e[117]=Fe):Fe=e[117];let $;e[118]!==Me||e[119]!==a.tasks.length?($=s.jsxs(Ue,{className:"flex flex-row items-center justify-between",children:[Fe,s.jsxs(ts,{variant:"outline",className:"text-base",children:["Progreso: ",Me," /"," ",a.tasks.length]})]}),e[118]=Me,e[119]=a.tasks.length,e[120]=$):$=e[120];const Je=Xe,hs="space-y-4";let Ie;e[121]===Symbol.for("react.memo_cache_sentinel")?(Ie=s.jsx(U,{children:"Descripción General / Observaciones"}),e[121]=Ie):Ie=e[121];const Ke=t.description||"Sin observaciones generales.";let z;e[122]!==Ke?(z=s.jsxs("div",{className:"space-y-2",children:[Ie,s.jsx("p",{className:"min-h-[60px] rounded border bg-muted p-3 text-sm text-muted-foreground",children:Ke})]}),e[122]=Ke,e[123]=z):z=e[123];let P;e[124]===Symbol.for("react.memo_cache_sentinel")?(P=s.jsx(ss,{}),e[124]=P):P=e[124];let Re;e[125]===Symbol.for("react.memo_cache_sentinel")?(Re=s.jsx(U,{className:"text-base font-semibold",children:"Tareas Específicas"}),e[125]=Re):Re=e[125];let D;e[126]!==Oe||e[127]!==i?(D=!i&&s.jsx(Q,{size:"sm",variant:"secondary",onClick:Oe,type:"button",children:"+ Agregar Tarea"}),e[126]=Oe,e[127]=i,e[128]=D):D=e[128];let L;e[129]!==D?(L=s.jsxs("div",{className:"flex items-center justify-between",children:[Re,D]}),e[129]=D,e[130]=L):L=e[130];let O;e[131]!==a.tasks.length?(O=a.tasks.length===0&&s.jsx("p",{className:"rounded border-2 border-dashed py-8 text-center text-muted-foreground",children:"No hay tareas registradas. Agrega una para comenzar el seguimiento."}),e[131]=a.tasks.length,e[132]=O):O=e[132];let A;if(e[133]!==a.tasks||e[134]!==i||e[135]!==ee||e[136]!==X||e[137]!==Y||e[138]!==Z){let l;e[140]!==i||e[141]!==ee||e[142]!==X||e[143]!==Y||e[144]!==Z?(l=(c,n)=>s.jsxs("div",{className:"flex flex-col items-start gap-3 rounded border bg-card p-3 transition-colors hover:bg-accent/5 md:flex-row md:items-center",children:[s.jsx(ls,{checked:c.is_completed,onCheckedChange:()=>X(n),disabled:i,className:"mt-1 md:mt-0"}),s.jsxs("div",{className:"w-full flex-1 space-y-2 md:flex md:gap-4 md:space-y-0",children:[s.jsx(es,{value:c.description,onChange:se=>Z(n,se.target.value),placeholder:"Descripción de la tarea",disabled:i,className:c.is_completed?"text-muted-foreground line-through":""}),s.jsxs("div",{className:"flex w-full items-center gap-2 md:w-32",children:[s.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:"$"}),s.jsx(es,{type:"number",value:c.cost??"",onChange:se=>Y(n,se.target.value),placeholder:"Costo",disabled:i})]})]}),!i&&s.jsx(Q,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>ee(n),type:"button",children:s.jsx(Ps,{className:"h-4 w-4"})})]},n),e[140]=i,e[141]=ee,e[142]=X,e[143]=Y,e[144]=Z,e[145]=l):l=e[145],A=a.tasks.map(l),e[133]=a.tasks,e[134]=i,e[135]=ee,e[136]=X,e[137]=Y,e[138]=Z,e[139]=A}else A=e[139];let M;e[146]!==L||e[147]!==O||e[148]!==A?(M=s.jsxs("div",{className:"space-y-4",children:[L,O,A]}),e[146]=L,e[147]=O,e[148]=A,e[149]=M):M=e[149];let V;e[150]===Symbol.for("react.memo_cache_sentinel")?(V=s.jsx(ss,{}),e[150]=V):V=e[150];const fs="flex items-center justify-end gap-4 pt-2";let B;e[151]===Symbol.for("react.memo_cache_sentinel")?(B=s.jsx("span",{className:"text-lg font-bold",children:"Costo Total Estimado:"}),e[151]=B):B=e[151];const xs="text-2xl font-bold text-primary",ps="$",Qe=cs.toLocaleString("es-CL");let H;e[152]!==Qe?(H=s.jsxs("span",{className:xs,children:[ps,Qe]}),e[152]=Qe,e[153]=H):H=e[153];let W;e[154]!==B||e[155]!==H?(W=s.jsxs("div",{className:fs,children:[B,H]}),e[154]=B,e[155]=H,e[156]=W):W=e[156];let G;e[157]!==Je||e[158]!==z||e[159]!==P||e[160]!==M||e[161]!==V||e[162]!==W?(G=s.jsxs(Je,{className:hs,children:[z,P,M,V,W]}),e[157]=Je,e[158]=z,e[159]=P,e[160]=M,e[161]=V,e[162]=W,e[163]=G):G=e[163];let q;e[164]!==qe||e[165]!==$||e[166]!==G?(q=s.jsx("div",{className:ms,children:s.jsxs(qe,{children:[$,G]})}),e[164]=qe,e[165]=$,e[166]=G,e[167]=q):q=e[167];let J;e[168]!==R||e[169]!==q?(J=s.jsxs("div",{className:ds,children:[R,q]}),e[168]=R,e[169]=q,e[170]=J):J=e[170];let K;e[171]!==b||e[172]!==J?(K=s.jsxs("div",{className:os,children:[b,J]}),e[171]=b,e[172]=J,e[173]=K):K=e[173];let $e;return e[174]!==Ve||e[175]!==m||e[176]!==h||e[177]!==K?($e=s.jsxs(Ve,{breadcrumbs:m,children:[h,K]}),e[174]=Ve,e[175]=m,e[176]=h,e[177]=K,e[178]=$e):$e=e[178],$e}function Ds(o){return s.jsx(Ss,{value:o,children:o},o)}function Ls(o){return o.is_completed}function Os(o,e){return o+(e.cost||0)}function As(o){return{...o,cost:o.cost?Number(o.cost):null}}export{nt as default};
