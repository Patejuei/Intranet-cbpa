import{c as mt,b as ht,r as Ue,u as Xe,j as t,H as xt,a as ft}from"./app-yTEI3rwQ.js";import{B as m}from"./badge-BY8xMe2q.js";import{B as ee}from"./button-DZ84VGHC.js";import{C as Fe}from"./checkbox-BoV1Ap-U.js";import{e as pt,b as Ye,D as Ze,a as et,f as tt,c as st,d as lt}from"./dialog-CTKo13j8.js";import{I as ut}from"./input-BL1HE6zX.js";import{L as h}from"./label-DWQw8x66.js";import{S as it,a as at,b as rt,c as nt,d as re}from"./select-BA6DtN4D.js";import{T as vt}from"./textarea-CB8ESZRH.js";import{A as jt}from"./app-layout-C9-ZT5uU.js";import{f as _t}from"./format-CSQe5d3I.js";import{P as gt}from"./plus-C-leFgpR.js";import{E as ct}from"./eye-CgslG7mh.js";/* empty css            */import"./index-DcmmnLCN.js";import"./index-B0b6YiDc.js";import"./index-BU9YzDWi.js";import"./check-EHhGwJXz.js";import"./chevron-down-7GosfSqF.js";import"./index-q7GIQJN5.js";import"./shield-CZtmOvLt.js";function $t(c){const e=mt.c(148),{issues:x,vehicles:Me}=c,{auth:o}=ht().props,[Te,We]=Ue.useState(!1),[Ee,Ve]=Ue.useState(!1),[te,Je]=Ue.useState(null);let ne;e[0]===Symbol.for("react.memo_cache_sentinel")?(ne={is_stopped:!1,sent_to_hq:!1,sent_to_workshop:!1,status:""},e[0]=ne):ne=e[0];const{data:n,setData:i,put:He,processing:Oe,reset:Pe}=Xe(ne);let ce;e[1]===Symbol.for("react.memo_cache_sentinel")?(ce={vehicle_id:"",description:"",severity:"Low",date:_t(new Date,"yyyy-MM-dd")},e[1]=ce):ce=e[1];const{data:a,setData:r,post:ze,processing:Ae,errors:d,reset:Be}=Xe(ce);let oe;e[2]!==ze||e[3]!==Be?(oe=s=>{s.preventDefault(),ze("/vehicles/incidents",{onSuccess:()=>{We(!1),Be()}})},e[2]=ze,e[3]=Be,e[4]=oe):oe=e[4];const Le=oe;let de;e[5]!==He||e[6]!==Pe||e[7]!==te?(de=s=>{s.preventDefault(),te&&He(`/vehicles/incidents/${te.id}`,{onSuccess:()=>{Ve(!1),Pe(),Je(null)}})},e[5]=He,e[6]=Pe,e[7]=te,e[8]=de):de=e[8];const Ge=de;let me;e[9]!==i?(me=s=>{Je(s),i({is_stopped:s.is_stopped,sent_to_hq:s.sent_to_hq,sent_to_workshop:s.sent_to_workshop,status:s.status}),Ve(!0)},e[9]=i,e[10]=me):me=e[10];const se=me,Ke=yt,ot=Nt,le=o.user.role==="capitan"||o.user.role==="comandante"||o.user.role==="admin"||o.user.role==="inspector"&&o.user.department==="Material Mayor",ie=o.user.role==="mechanic"||o.user.role==="admin",ae=o.user.company==="Comandancia"||o.user.role==="admin";let he,xe;e[11]===Symbol.for("react.memo_cache_sentinel")?(he=[{title:"Material Mayor",href:"/vehicles/dashboard"},{title:"Incidencias",href:"/vehicles/incidents"}],xe=t.jsx(xt,{title:"Registro de Incidencias"}),e[11]=he,e[12]=xe):(he=e[11],xe=e[12]);let fe;e[13]===Symbol.for("react.memo_cache_sentinel")?(fe=t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Registro de Incidencias"}),t.jsx("p",{className:"text-muted-foreground",children:"Reporte y seguimiento de problemas mecánicos."})]}),e[13]=fe):fe=e[13];let pe;e[14]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsx(pt,{asChild:!0,children:t.jsxs(ee,{children:[t.jsx(gt,{className:"mr-2 h-4 w-4"})," Nueva Incidencia"]})}),e[14]=pe):pe=e[14];let ue;e[15]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsxs(Ye,{children:[t.jsx(Ze,{children:"Reportar Incidencia"}),t.jsx(et,{children:"Ingrese los detalles del problema detectado en la unidad."})]}),e[15]=ue):ue=e[15];let ve;e[16]===Symbol.for("react.memo_cache_sentinel")?(ve=t.jsx(h,{htmlFor:"vehicle",children:"Vehículo"}),e[16]=ve):ve=e[16];let f;e[17]!==r?(f=s=>r("vehicle_id",s),e[17]=r,e[18]=f):f=e[18];const dt=a.vehicle_id;let je;e[19]===Symbol.for("react.memo_cache_sentinel")?(je=t.jsx(at,{children:t.jsx(rt,{placeholder:"Seleccione unidad"})}),e[19]=je):je=e[19];let p;e[20]!==Me?(p=Me.map(bt),e[20]=Me,e[21]=p):p=e[21];let u;e[22]!==p?(u=t.jsx(nt,{children:p}),e[22]=p,e[23]=u):u=e[23];let v;e[24]!==a.vehicle_id||e[25]!==f||e[26]!==u?(v=t.jsxs(it,{onValueChange:f,value:dt,children:[je,u]}),e[24]=a.vehicle_id,e[25]=f,e[26]=u,e[27]=v):v=e[27];let j;e[28]!==d.vehicle_id?(j=d.vehicle_id&&t.jsx("p",{className:"text-sm text-destructive",children:d.vehicle_id}),e[28]=d.vehicle_id,e[29]=j):j=e[29];let _;e[30]!==v||e[31]!==j?(_=t.jsxs("div",{className:"grid gap-2",children:[ve,v,j]}),e[30]=v,e[31]=j,e[32]=_):_=e[32];let _e;e[33]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsx(h,{htmlFor:"severity",children:"Severidad"}),e[33]=_e):_e=e[33];let g;e[34]!==r?(g=s=>r("severity",s),e[34]=r,e[35]=g):g=e[35];let ge;e[36]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsx(at,{children:t.jsx(rt,{placeholder:"Nivel de Gravedad"})}),e[36]=ge):ge=e[36];let be;e[37]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsxs(nt,{children:[t.jsx(re,{value:"Low",children:"Baja (Observación)"}),t.jsx(re,{value:"Medium",children:"Media (Reparación necesaria)"}),t.jsx(re,{value:"High",children:"Alta (Riesgo operativo)"}),t.jsx(re,{value:"Critical",children:"Crítica (Inoperativo)"})]}),e[37]=be):be=e[37];let b;e[38]!==a.severity||e[39]!==g?(b=t.jsxs("div",{className:"grid gap-2",children:[_e,t.jsxs(it,{onValueChange:g,value:a.severity,children:[ge,be]})]}),e[38]=a.severity,e[39]=g,e[40]=b):b=e[40];let Ne;e[41]===Symbol.for("react.memo_cache_sentinel")?(Ne=t.jsx(h,{htmlFor:"date",children:"Fecha Detección"}),e[41]=Ne):Ne=e[41];let N;e[42]!==r?(N=s=>r("date",s.target.value),e[42]=r,e[43]=N):N=e[43];let y;e[44]!==a.date||e[45]!==N?(y=t.jsxs("div",{className:"grid gap-2",children:[Ne,t.jsx(ut,{type:"date",value:a.date,onChange:N})]}),e[44]=a.date,e[45]=N,e[46]=y):y=e[46];let ye;e[47]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx(h,{htmlFor:"description",children:"Descripción del Problema"}),e[47]=ye):ye=e[47];let w;e[48]!==r?(w=s=>r("description",s.target.value),e[48]=r,e[49]=w):w=e[49];let S;e[50]!==a.description||e[51]!==w?(S=t.jsx(vt,{id:"description",value:a.description,onChange:w,placeholder:"Detalle el problema, observaciones, etc."}),e[50]=a.description,e[51]=w,e[52]=S):S=e[52];let R;e[53]!==d.description?(R=d.description&&t.jsx("p",{className:"text-sm text-destructive",children:d.description}),e[53]=d.description,e[54]=R):R=e[54];let C;e[55]!==S||e[56]!==R?(C=t.jsxs("div",{className:"grid gap-2",children:[ye,S,R]}),e[55]=S,e[56]=R,e[57]=C):C=e[57];let k;e[58]!==_||e[59]!==b||e[60]!==y||e[61]!==C?(k=t.jsxs("div",{className:"grid gap-4 py-4",children:[_,b,y,C]}),e[58]=_,e[59]=b,e[60]=y,e[61]=C,e[62]=k):k=e[62];let D;e[63]!==Ae?(D=t.jsx(tt,{children:t.jsx(ee,{type:"submit",disabled:Ae,children:"Reportar"})}),e[63]=Ae,e[64]=D):D=e[64];let I;e[65]!==Le||e[66]!==k||e[67]!==D?(I=t.jsx(st,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:Le,children:[ue,k,D]})}),e[65]=Le,e[66]=k,e[67]=D,e[68]=I):I=e[68];let q;e[69]!==Te||e[70]!==I?(q=t.jsxs(lt,{open:Te,onOpenChange:We,children:[pe,I]}),e[69]=Te,e[70]=I,e[71]=q):q=e[71];let we;e[72]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx(Ze,{children:"Revisión de Incidencia"}),e[72]=we):we=e[72];const $e=te?.vehicle.name;let F;e[73]!==$e?(F=t.jsxs(Ye,{children:[we,t.jsxs(et,{children:["Determinar acciones a seguir para"," ",$e]})]}),e[73]=$e,e[74]=F):F=e[74];let M;e[75]!==i?(M=s=>i("is_stopped",s),e[75]=i,e[76]=M):M=e[76];let T;e[77]!==n.is_stopped||e[78]!==M?(T=t.jsx(Fe,{id:"review_is_stopped",checked:n.is_stopped,onCheckedChange:M}),e[77]=n.is_stopped,e[78]=M,e[79]=T):T=e[79];let Se;e[80]===Symbol.for("react.memo_cache_sentinel")?(Se=t.jsx(h,{htmlFor:"review_is_stopped",className:"font-bold text-destructive",children:"Material Fuera de Servicio"}),e[80]=Se):Se=e[80];let E;e[81]!==T?(E=t.jsxs("div",{className:"flex items-center space-x-2",children:[T,Se]}),e[81]=T,e[82]=E):E=e[82];const Qe=n.status==="Resolved";let V;e[83]!==i?(V=s=>i("status",s?"Resolved":"Open"),e[83]=i,e[84]=V):V=e[84];let H;e[85]!==Qe||e[86]!==V?(H=t.jsx(Fe,{id:"review_status",checked:Qe,onCheckedChange:V}),e[85]=Qe,e[86]=V,e[87]=H):H=e[87];let Re;e[88]===Symbol.for("react.memo_cache_sentinel")?(Re=t.jsx(h,{htmlFor:"review_status",className:"font-bold text-green-600",children:"Incidencia Resuelta"}),e[88]=Re):Re=e[88];let O;e[89]!==H?(O=t.jsxs("div",{className:"flex items-center space-x-2",children:[H,Re]}),e[89]=H,e[90]=O):O=e[90];let Ce;e[91]===Symbol.for("react.memo_cache_sentinel")?(Ce=t.jsx("h4",{className:"text-sm font-medium",children:"Notificaciones"}),e[91]=Ce):Ce=e[91];let P;e[92]!==i?(P=s=>i("sent_to_hq",s),e[92]=i,e[93]=P):P=e[93];let z;e[94]!==n.sent_to_hq||e[95]!==P?(z=t.jsx(Fe,{id:"sent_to_hq",checked:n.sent_to_hq,onCheckedChange:P}),e[94]=n.sent_to_hq,e[95]=P,e[96]=z):z=e[96];let ke;e[97]===Symbol.for("react.memo_cache_sentinel")?(ke=t.jsx(h,{htmlFor:"sent_to_hq",children:"Reportar a Comandancia"}),e[97]=ke):ke=e[97];let A;e[98]!==z?(A=t.jsxs("div",{className:"flex items-center space-x-2",children:[z,ke]}),e[98]=z,e[99]=A):A=e[99];let B;e[100]!==i?(B=s=>i("sent_to_workshop",s),e[100]=i,e[101]=B):B=e[101];let L;e[102]!==n.sent_to_workshop||e[103]!==B?(L=t.jsx(Fe,{id:"sent_to_workshop",checked:n.sent_to_workshop,onCheckedChange:B}),e[102]=n.sent_to_workshop,e[103]=B,e[104]=L):L=e[104];let De;e[105]===Symbol.for("react.memo_cache_sentinel")?(De=t.jsx(h,{htmlFor:"sent_to_workshop",children:"Reportar a Taller Mecánico"}),e[105]=De):De=e[105];let G;e[106]!==L?(G=t.jsxs("div",{className:"flex items-center space-x-2",children:[L,De]}),e[106]=L,e[107]=G):G=e[107];let $;e[108]!==A||e[109]!==G?($=t.jsxs("div",{className:"space-y-2 border-t pt-4",children:[Ce,A,G]}),e[108]=A,e[109]=G,e[110]=$):$=e[110];let Q;e[111]!==E||e[112]!==O||e[113]!==$?(Q=t.jsxs("div",{className:"grid gap-4 py-4",children:[E,O,$]}),e[111]=E,e[112]=O,e[113]=$,e[114]=Q):Q=e[114];let U;e[115]!==Oe?(U=t.jsx(tt,{children:t.jsx(ee,{type:"submit",disabled:Oe,children:"Guardar Revisión"})}),e[115]=Oe,e[116]=U):U=e[116];let W;e[117]!==Ge||e[118]!==F||e[119]!==Q||e[120]!==U?(W=t.jsx(st,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:Ge,children:[F,Q,U]})}),e[117]=Ge,e[118]=F,e[119]=Q,e[120]=U,e[121]=W):W=e[121];let J;e[122]!==Ee||e[123]!==W?(J=t.jsx(lt,{open:Ee,onOpenChange:Ve,children:W}),e[122]=Ee,e[123]=W,e[124]=J):J=e[124];let K;e[125]!==q||e[126]!==J?(K=t.jsxs("div",{className:"flex items-center justify-between",children:[fe,q,J]}),e[125]=q,e[126]=J,e[127]=K):K=e[127];let Ie;e[128]===Symbol.for("react.memo_cache_sentinel")?(Ie=t.jsx("thead",{className:"[&_tr]:border-b",children:t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:[t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Fecha"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Unidad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Gravedad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Descripción"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Estado"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Reportado Por"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Acciones"})]})}),e[128]=Ie):Ie=e[128];let X;if(e[129]!==le||e[130]!==ae||e[131]!==ie||e[132]!==x.data||e[133]!==se){let s;e[135]!==le||e[136]!==ae||e[137]!==ie||e[138]!==se?(s=l=>t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50",children:[t.jsx("td",{className:"p-4 align-middle",children:l.date}),t.jsx("td",{className:"p-4 align-middle font-medium",children:l.vehicle.name}),t.jsx("td",{className:"p-4 align-middle",children:t.jsx(m,{variant:ot(l.severity),children:l.severity})}),t.jsx("td",{className:"max-w-[300px] truncate p-4 align-middle",children:l.description}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[l.is_stopped&&t.jsx(m,{variant:"destructive",className:"w-fit",children:"Detenido"}),l.status==="Resolved"&&t.jsx(m,{variant:"outline",className:"w-fit border-green-500 bg-green-50 text-green-700",children:"Resuelto"}),l.status==="En Taller"&&t.jsx(m,{variant:"secondary",className:"w-fit bg-blue-100 text-blue-700 hover:bg-blue-100/80",children:"En Taller"}),l.status!=="Resolved"&&l.status!=="En Taller"&&t.jsxs(t.Fragment,{children:[!l.reviewed_at&&t.jsx(m,{variant:"outline",className:"w-fit border-yellow-500 text-yellow-600",children:"Pendiente Revisión"}),l.reviewed_at&&t.jsx(m,{variant:"outline",className:"w-fit border-blue-500 text-blue-600",children:"Revisado"}),l.sent_to_hq&&t.jsx(m,{variant:l.hq_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.hq_read_at?"Visto Comandancia":"Enviado Comandancia"}),l.sent_to_workshop&&t.jsx(m,{variant:l.workshop_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.workshop_read_at?"Visto Taller":"Enviado Taller"})]})]})}),t.jsx("td",{className:"p-4 align-middle",children:l.reporter?.name||"Desconocido"}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex gap-2",children:[le&&t.jsx(ee,{size:"sm",variant:"outline",onClick:()=>se(l),children:"Revisar"}),ie&&l.sent_to_workshop&&!l.workshop_read_at&&t.jsxs(ee,{size:"sm",variant:"ghost",onClick:()=>Ke(l),title:"Marcar como Visto",children:[t.jsx(ct,{className:"mr-1 size-4"})," ","Taller"]}),ae&&l.sent_to_hq&&!l.hq_read_at&&t.jsxs(ee,{size:"sm",variant:"ghost",onClick:()=>Ke(l),title:"Marcar como Visto",children:[t.jsx(ct,{className:"mr-1 size-4"})," ","HQ"]})]})})]},l.id),e[135]=le,e[136]=ae,e[137]=ie,e[138]=se,e[139]=s):s=e[139],X=x.data.map(s),e[129]=le,e[130]=ae,e[131]=ie,e[132]=x.data,e[133]=se,e[134]=X}else X=e[134];let Y;e[140]!==x.data.length?(Y=x.data.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"p-4 text-center text-muted-foreground",children:"No hay incidencias registradas."})}),e[140]=x.data.length,e[141]=Y):Y=e[141];let Z;e[142]!==X||e[143]!==Y?(Z=t.jsx("div",{className:"rounded-md border",children:t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsxs("table",{className:"w-full caption-bottom text-sm",children:[Ie,t.jsxs("tbody",{className:"[&_tr:last-child]:border-0",children:[X,Y]})]})})}),e[142]=X,e[143]=Y,e[144]=Z):Z=e[144];let qe;return e[145]!==K||e[146]!==Z?(qe=t.jsxs(jt,{breadcrumbs:he,children:[xe,t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[K,Z]})]}),e[145]=K,e[146]=Z,e[147]=qe):qe=e[147],qe}function bt(c){return t.jsx(re,{value:c.id.toString(),children:c.name},c.id)}function Nt(c){switch(c){case"Critical":return"destructive";case"High":return"destructive";case"Medium":return"secondary";default:return"outline"}}function yt(c){ft.patch(`/vehicles/incidents/${c.id}/mark-read`,{},{preserveScroll:!0})}export{$t as default};
