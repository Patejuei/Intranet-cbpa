import{c as dt,b as mt,r as Ue,u as Qe,j as t,H as ht,a as pt}from"./app-BHG2hm5T.js";import{B as m}from"./badge-D2mGt2FT.js";import{B as ee}from"./button-Z6kmdew5.js";import{C as Ie}from"./checkbox-CsX5p4af.js";import{e as xt,b as Xe,D as Ye,a as Ze,f as et,c as tt,d as st}from"./dialog-CDU1cgIy.js";import{I as ft}from"./input-SlT7uC8i.js";import{L as h}from"./label-BQc_PkxT.js";import{S as lt,a as it,b as at,c as rt,d as ae}from"./select-CKEgZyTl.js";import{T as ut}from"./textarea-fZP289le.js";import{A as vt}from"./app-layout-hnxNyFOA.js";import{f as jt}from"./format-CSQe5d3I.js";import{P as _t}from"./plus-CTnaVD1C.js";import{E as nt}from"./eye-YsmfeBeD.js";/* empty css            */import"./index-KJ8nIQ1N.js";import"./index-Q1HKqKhG.js";import"./index-DM6PgUW3.js";import"./check-CGeZhyYa.js";import"./chevron-down-BbetoyTj.js";import"./index-q7GIQJN5.js";import"./shield-Nszra4Fu.js";function Gt(c){const e=dt.c(152),{issues:p,vehicles:qe}=c,{auth:i}=mt().props,[Fe,We]=Ue.useState(!1),[Te,Ee]=Ue.useState(!1),[te,Je]=Ue.useState(null);let re;e[0]===Symbol.for("react.memo_cache_sentinel")?(re={is_stopped:!1,sent_to_hq:!1,sent_to_workshop:!1,status:""},e[0]=re):re=e[0];const{data:o,setData:a,put:Ve,processing:Oe,reset:Pe}=Qe(re);let ne;e[1]===Symbol.for("react.memo_cache_sentinel")?(ne={vehicle_id:"",description:"",severity:"Low",date:jt(new Date,"yyyy-MM-dd")},e[1]=ne):ne=e[1];const{data:r,setData:n,post:ze,processing:Ae,errors:d,reset:Be}=Qe(ne);let oe;e[2]!==ze||e[3]!==Be?(oe=s=>{s.preventDefault(),ze("/vehicles/incidents",{onSuccess:()=>{We(!1),Be()}})},e[2]=ze,e[3]=Be,e[4]=oe):oe=e[4];const He=oe;let ce;e[5]!==Ve||e[6]!==Pe||e[7]!==te?(ce=s=>{s.preventDefault(),te&&Ve(`/vehicles/incidents/${te.id}`,{onSuccess:()=>{Ee(!1),Pe(),Je(null)}})},e[5]=Ve,e[6]=Pe,e[7]=te,e[8]=ce):ce=e[8];const Le=ce;let de;e[9]!==a?(de=s=>{Je(s),a({is_stopped:s.is_stopped,sent_to_hq:s.sent_to_hq,sent_to_workshop:s.sent_to_workshop,status:s.status}),Ee(!0)},e[9]=a,e[10]=de):de=e[10];const se=de,Ke=yt,ot=bt,le=i.user.role==="capitan"||i.user.role==="comandante"||i.user.role==="admin"||i.user.role==="inspector"&&i.user.department==="Material Mayor",ie=i.user.role==="mechanic"||i.user.role==="admin";i.user.company==="Comandancia"||i.user.role;let me,he;e[11]===Symbol.for("react.memo_cache_sentinel")?(me=[{title:"Material Mayor",href:"/vehicles/dashboard"},{title:"Incidencias",href:"/vehicles/incidents"}],he=t.jsx(ht,{title:"Registro de Incidencias"}),e[11]=me,e[12]=he):(me=e[11],he=e[12]);let pe;e[13]===Symbol.for("react.memo_cache_sentinel")?(pe=t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Registro de Incidencias"}),t.jsx("p",{className:"text-muted-foreground",children:"Reporte y seguimiento de problemas mecánicos."})]}),e[13]=pe):pe=e[13];let xe;e[14]===Symbol.for("react.memo_cache_sentinel")?(xe=t.jsx(xt,{asChild:!0,children:t.jsxs(ee,{children:[t.jsx(_t,{className:"mr-2 h-4 w-4"})," Nueva Incidencia"]})}),e[14]=xe):xe=e[14];let fe;e[15]===Symbol.for("react.memo_cache_sentinel")?(fe=t.jsxs(Xe,{children:[t.jsx(Ye,{children:"Reportar Incidencia"}),t.jsx(Ze,{children:"Ingrese los detalles del problema detectado en la unidad."})]}),e[15]=fe):fe=e[15];let ue;e[16]===Symbol.for("react.memo_cache_sentinel")?(ue=t.jsx(h,{htmlFor:"vehicle",children:"Vehículo"}),e[16]=ue):ue=e[16];let x;e[17]!==n?(x=s=>n("vehicle_id",s),e[17]=n,e[18]=x):x=e[18];const ct=r.vehicle_id;let ve;e[19]===Symbol.for("react.memo_cache_sentinel")?(ve=t.jsx(it,{children:t.jsx(at,{placeholder:"Seleccione unidad"})}),e[19]=ve):ve=e[19];let f;e[20]!==qe?(f=qe.map(gt),e[20]=qe,e[21]=f):f=e[21];let u;e[22]!==f?(u=t.jsx(rt,{children:f}),e[22]=f,e[23]=u):u=e[23];let v;e[24]!==r.vehicle_id||e[25]!==x||e[26]!==u?(v=t.jsxs(lt,{onValueChange:x,value:ct,children:[ve,u]}),e[24]=r.vehicle_id,e[25]=x,e[26]=u,e[27]=v):v=e[27];let j;e[28]!==d.vehicle_id?(j=d.vehicle_id&&t.jsx("p",{className:"text-sm text-destructive",children:d.vehicle_id}),e[28]=d.vehicle_id,e[29]=j):j=e[29];let _;e[30]!==v||e[31]!==j?(_=t.jsxs("div",{className:"grid gap-2",children:[ue,v,j]}),e[30]=v,e[31]=j,e[32]=_):_=e[32];let je;e[33]===Symbol.for("react.memo_cache_sentinel")?(je=t.jsx(h,{htmlFor:"severity",children:"Severidad"}),e[33]=je):je=e[33];let g;e[34]!==n?(g=s=>n("severity",s),e[34]=n,e[35]=g):g=e[35];let _e;e[36]===Symbol.for("react.memo_cache_sentinel")?(_e=t.jsx(it,{children:t.jsx(at,{placeholder:"Nivel de Gravedad"})}),e[36]=_e):_e=e[36];let ge;e[37]===Symbol.for("react.memo_cache_sentinel")?(ge=t.jsxs(rt,{children:[t.jsx(ae,{value:"Low",children:"Baja (Observación)"}),t.jsx(ae,{value:"Medium",children:"Media (Reparación necesaria)"}),t.jsx(ae,{value:"High",children:"Alta (Riesgo operativo)"}),t.jsx(ae,{value:"Critical",children:"Crítica (Inoperativo)"})]}),e[37]=ge):ge=e[37];let b;e[38]!==r.severity||e[39]!==g?(b=t.jsxs("div",{className:"grid gap-2",children:[je,t.jsxs(lt,{onValueChange:g,value:r.severity,children:[_e,ge]})]}),e[38]=r.severity,e[39]=g,e[40]=b):b=e[40];let be;e[41]===Symbol.for("react.memo_cache_sentinel")?(be=t.jsx(h,{htmlFor:"date",children:"Fecha Detección"}),e[41]=be):be=e[41];let y;e[42]!==n?(y=s=>n("date",s.target.value),e[42]=n,e[43]=y):y=e[43];let N;e[44]!==r.date||e[45]!==y?(N=t.jsxs("div",{className:"grid gap-2",children:[be,t.jsx(ft,{type:"date",value:r.date,onChange:y})]}),e[44]=r.date,e[45]=y,e[46]=N):N=e[46];let ye;e[47]===Symbol.for("react.memo_cache_sentinel")?(ye=t.jsx(h,{htmlFor:"description",children:"Descripción del Problema"}),e[47]=ye):ye=e[47];let w;e[48]!==n?(w=s=>n("description",s.target.value),e[48]=n,e[49]=w):w=e[49];let S;e[50]!==r.description||e[51]!==w?(S=t.jsx(ut,{id:"description",value:r.description,onChange:w,placeholder:"Detalle el problema, observaciones, etc."}),e[50]=r.description,e[51]=w,e[52]=S):S=e[52];let R;e[53]!==d.description?(R=d.description&&t.jsx("p",{className:"text-sm text-destructive",children:d.description}),e[53]=d.description,e[54]=R):R=e[54];let k;e[55]!==S||e[56]!==R?(k=t.jsxs("div",{className:"grid gap-2",children:[ye,S,R]}),e[55]=S,e[56]=R,e[57]=k):k=e[57];let C;e[58]!==_||e[59]!==b||e[60]!==N||e[61]!==k?(C=t.jsxs("div",{className:"grid gap-4 py-4",children:[_,b,N,k]}),e[58]=_,e[59]=b,e[60]=N,e[61]=k,e[62]=C):C=e[62];let D;e[63]!==Ae?(D=t.jsx(et,{children:t.jsx(ee,{type:"submit",disabled:Ae,children:"Reportar"})}),e[63]=Ae,e[64]=D):D=e[64];let M;e[65]!==He||e[66]!==C||e[67]!==D?(M=t.jsx(tt,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:He,children:[fe,C,D]})}),e[65]=He,e[66]=C,e[67]=D,e[68]=M):M=e[68];let I;e[69]!==Fe||e[70]!==M?(I=t.jsxs(st,{open:Fe,onOpenChange:We,children:[xe,M]}),e[69]=Fe,e[70]=M,e[71]=I):I=e[71];let Ne;e[72]===Symbol.for("react.memo_cache_sentinel")?(Ne=t.jsx(Ye,{children:"Revisión de Incidencia"}),e[72]=Ne):Ne=e[72];const Ge=te?.vehicle.name;let q;e[73]!==Ge?(q=t.jsxs(Xe,{children:[Ne,t.jsxs(Ze,{children:["Determinar acciones a seguir para"," ",Ge]})]}),e[73]=Ge,e[74]=q):q=e[74];let F;e[75]!==a?(F=s=>a("is_stopped",s),e[75]=a,e[76]=F):F=e[76];let T;e[77]!==o.is_stopped||e[78]!==F?(T=t.jsx(Ie,{id:"review_is_stopped",checked:o.is_stopped,onCheckedChange:F}),e[77]=o.is_stopped,e[78]=F,e[79]=T):T=e[79];let we;e[80]===Symbol.for("react.memo_cache_sentinel")?(we=t.jsx(h,{htmlFor:"review_is_stopped",className:"font-bold text-destructive",children:"Material Fuera de Servicio"}),e[80]=we):we=e[80];let E;e[81]!==T?(E=t.jsxs("div",{className:"flex items-center space-x-2",children:[T,we]}),e[81]=T,e[82]=E):E=e[82];const $e=o.status==="Resolved";let V;e[83]!==a?(V=s=>a("status",s?"Resolved":"Open"),e[83]=a,e[84]=V):V=e[84];let O;e[85]!==$e||e[86]!==V?(O=t.jsx(Ie,{id:"review_status",checked:$e,onCheckedChange:V}),e[85]=$e,e[86]=V,e[87]=O):O=e[87];let Se;e[88]===Symbol.for("react.memo_cache_sentinel")?(Se=t.jsx(h,{htmlFor:"review_status",className:"font-bold text-green-600",children:"Incidencia Resuelta"}),e[88]=Se):Se=e[88];let P;e[89]!==O?(P=t.jsxs("div",{className:"flex items-center space-x-2",children:[O,Se]}),e[89]=O,e[90]=P):P=e[90];let Re;e[91]===Symbol.for("react.memo_cache_sentinel")?(Re=t.jsx("h4",{className:"text-sm font-medium",children:"Notificaciones"}),e[91]=Re):Re=e[91];let z;e[92]!==a?(z=s=>a("sent_to_hq",s),e[92]=a,e[93]=z):z=e[93];let A;e[94]!==o.sent_to_hq||e[95]!==z?(A=t.jsx(Ie,{id:"sent_to_hq",checked:o.sent_to_hq,onCheckedChange:z}),e[94]=o.sent_to_hq,e[95]=z,e[96]=A):A=e[96];let ke;e[97]===Symbol.for("react.memo_cache_sentinel")?(ke=t.jsx(h,{htmlFor:"sent_to_hq",children:"Reportar a Material Mayor"}),e[97]=ke):ke=e[97];let B;e[98]!==A?(B=t.jsxs("div",{className:"flex items-center space-x-2",children:[A,ke]}),e[98]=A,e[99]=B):B=e[99];let H;e[100]!==a?(H=s=>a("sent_to_workshop",s),e[100]=a,e[101]=H):H=e[101];let L;e[102]!==o.sent_to_workshop||e[103]!==H?(L=t.jsx(Ie,{id:"sent_to_workshop",checked:o.sent_to_workshop,onCheckedChange:H}),e[102]=o.sent_to_workshop,e[103]=H,e[104]=L):L=e[104];let Ce;e[105]===Symbol.for("react.memo_cache_sentinel")?(Ce=t.jsx(h,{htmlFor:"sent_to_workshop",children:"Reportar a Taller Mecánico"}),e[105]=Ce):Ce=e[105];let G;e[106]!==L?(G=t.jsxs("div",{className:"flex items-center space-x-2",children:[L,Ce]}),e[106]=L,e[107]=G):G=e[107];let $;e[108]!==B||e[109]!==G?($=t.jsxs("div",{className:"space-y-2 border-t pt-4",children:[Re,B,G]}),e[108]=B,e[109]=G,e[110]=$):$=e[110];let U;e[111]!==E||e[112]!==P||e[113]!==$?(U=t.jsxs("div",{className:"grid gap-4 py-4",children:[E,P,$]}),e[111]=E,e[112]=P,e[113]=$,e[114]=U):U=e[114];let W;e[115]!==Oe?(W=t.jsx(et,{children:t.jsx(ee,{type:"submit",disabled:Oe,children:"Guardar Revisión"})}),e[115]=Oe,e[116]=W):W=e[116];let J;e[117]!==Le||e[118]!==q||e[119]!==U||e[120]!==W?(J=t.jsx(tt,{className:"sm:max-w-[500px]",children:t.jsxs("form",{onSubmit:Le,children:[q,U,W]})}),e[117]=Le,e[118]=q,e[119]=U,e[120]=W,e[121]=J):J=e[121];let K;e[122]!==Te||e[123]!==J?(K=t.jsx(st,{open:Te,onOpenChange:Ee,children:J}),e[122]=Te,e[123]=J,e[124]=K):K=e[124];let Q;e[125]!==I||e[126]!==K?(Q=t.jsxs("div",{className:"flex items-center justify-between",children:[pe,I,K]}),e[125]=I,e[126]=K,e[127]=Q):Q=e[127];let De;e[128]===Symbol.for("react.memo_cache_sentinel")?(De=t.jsx("thead",{className:"[&_tr]:border-b",children:t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:[t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Fecha"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Unidad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Gravedad"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Descripción"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Estado"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Reportado Por"}),t.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Acciones"})]})}),e[128]=De):De=e[128];let X;if(e[129]!==i.user.company||e[130]!==i.user.department||e[131]!==i.user.role||e[132]!==le||e[133]!==ie||e[134]!==p.data||e[135]!==se){let s;e[137]!==i.user.company||e[138]!==i.user.department||e[139]!==i.user.role||e[140]!==le||e[141]!==ie||e[142]!==se?(s=l=>t.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50",children:[t.jsx("td",{className:"p-4 align-middle",children:l.date}),t.jsx("td",{className:"p-4 align-middle font-medium",children:l.vehicle.name}),t.jsx("td",{className:"p-4 align-middle",children:t.jsx(m,{variant:ot(l.severity),children:l.severity})}),t.jsx("td",{className:"max-w-[300px] truncate p-4 align-middle",children:l.description}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[l.is_stopped&&t.jsx(m,{variant:"destructive",className:"w-fit",children:"Detenido"}),l.status==="Resolved"&&t.jsx(m,{variant:"outline",className:"w-fit border-green-500 bg-green-50 text-green-700",children:"Resuelto"}),l.status==="En Taller"&&t.jsx(m,{variant:"secondary",className:"w-fit bg-blue-100 text-blue-700 hover:bg-blue-100/80",children:"En Taller"}),l.status!=="Resolved"&&l.status!=="En Taller"&&t.jsxs(t.Fragment,{children:[!l.reviewed_at&&t.jsx(m,{variant:"outline",className:"w-fit border-yellow-500 text-yellow-600",children:"Pendiente Revisión"}),l.reviewed_at&&t.jsx(m,{variant:"outline",className:"w-fit border-blue-500 text-blue-600",children:"Revisado"}),l.sent_to_hq&&t.jsx(m,{variant:l.hq_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.hq_read_at?"Visto M. Mayor":"Enviado M. Mayor"}),l.sent_to_workshop&&t.jsx(m,{variant:l.workshop_read_at?"secondary":"outline",className:"w-fit text-xs",children:l.workshop_read_at?"Visto Taller":"Enviado Taller"})]})]})}),t.jsx("td",{className:"p-4 align-middle",children:l.reporter?.name||"Desconocido"}),t.jsx("td",{className:"p-4 align-middle",children:t.jsxs("div",{className:"flex gap-2",children:[le&&t.jsx(ee,{size:"sm",variant:"outline",onClick:()=>se(l),children:"Revisar"}),ie&&l.sent_to_workshop&&!l.workshop_read_at&&t.jsxs(ee,{size:"sm",variant:"ghost",onClick:()=>Ke(l),title:"Marcar como Visto",children:[t.jsx(nt,{className:"mr-1 size-4"})," ","Taller"]}),(i.user.role==="inspector"&&i.user.department==="Material Mayor"||i.user.role==="comandante"||i.user.company==="Comandancia")&&l.sent_to_hq&&!l.hq_read_at&&t.jsxs(ee,{size:"sm",variant:"ghost",onClick:()=>Ke(l),title:"Marcar como Visto",children:[t.jsx(nt,{className:"mr-1 size-4"})," ","Visto"]})]})})]},l.id),e[137]=i.user.company,e[138]=i.user.department,e[139]=i.user.role,e[140]=le,e[141]=ie,e[142]=se,e[143]=s):s=e[143],X=p.data.map(s),e[129]=i.user.company,e[130]=i.user.department,e[131]=i.user.role,e[132]=le,e[133]=ie,e[134]=p.data,e[135]=se,e[136]=X}else X=e[136];let Y;e[144]!==p.data.length?(Y=p.data.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"p-4 text-center text-muted-foreground",children:"No hay incidencias registradas."})}),e[144]=p.data.length,e[145]=Y):Y=e[145];let Z;e[146]!==X||e[147]!==Y?(Z=t.jsx("div",{className:"rounded-md border",children:t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsxs("table",{className:"w-full caption-bottom text-sm",children:[De,t.jsxs("tbody",{className:"[&_tr:last-child]:border-0",children:[X,Y]})]})})}),e[146]=X,e[147]=Y,e[148]=Z):Z=e[148];let Me;return e[149]!==Q||e[150]!==Z?(Me=t.jsxs(vt,{breadcrumbs:me,children:[he,t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 p-4",children:[Q,Z]})]}),e[149]=Q,e[150]=Z,e[151]=Me):Me=e[151],Me}function gt(c){return t.jsx(ae,{value:c.id.toString(),children:c.name},c.id)}function bt(c){switch(c){case"Critical":return"destructive";case"High":return"destructive";case"Medium":return"secondary";default:return"outline"}}function yt(c){pt.patch(`/vehicles/incidents/${c.id}/mark-read`,{},{preserveScroll:!0})}export{Gt as default};
