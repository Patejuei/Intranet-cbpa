import{c as ze,b as Be,u as Re,j as s,L as Ne,H as We}from"./app-DqJRurs1.js";import{B as Ie}from"./badge-CepKMCgw.js";import{a as qe,B as ee,f as ae}from"./button-DjAOAa26.js";import{b as g,C as se,a as te,c as _}from"./card-Bkm9o71p.js";import{d as Ue,e as Ge,c as Je,b as Ke,D as Qe,a as Xe,f as Ye}from"./dialog-BSRr0mKr.js";import{I as $e}from"./input-Lo7sbtkP.js";import{L as Me}from"./label-ftNnSK4z.js";import{u as Ze}from"./use-permissions-0DIawRbY.js";import{W as Fe,A as es,C as ss,F as ts}from"./app-layout-CfzyVo4N.js";import{C as Ae}from"./calendar-Dj-yQPaV.js";import{C as Oe}from"./circle-check-Cx1ctuwH.js";import{C as Pe}from"./circle-alert-AwBDPzWz.js";import{A as as}from"./arrow-left-hcZnST0T.js";/* empty css            */import"./index-BNXme8FC.js";import"./index-Cv-Kt0x8.js";import"./index-C4J_hXM0.js";import"./shield-B2C_Opvg.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],is=qe("DollarSign",ls);function Ms(a){const e=ze.c(156),{vehicle:t,totalMaintenanceCost:le}=a,l=Be().props,{canEdit:n}=Ze(),r=t.issues?.[0],i=t.maintenances?.[0],Ve=ps,be=hs,ve=t.technical_review_expires_at||"",ye=t.circulation_permit_expires_at||"",we=t.insurance_expires_at||"";let de;e[0]!==ve||e[1]!==ye||e[2]!==we?(de={technical_review_expires_at:ve,circulation_permit_expires_at:ye,insurance_expires_at:we},e[0]=ve,e[1]=ye,e[2]=we,e[3]=de):de=e[3];const{data:f,setData:j,patch:ke,processing:ie,errors:c}=Re(de);let oe;e[4]!==ke||e[5]!==t.id?(oe=ce=>{ce.preventDefault(),ke(`/vehicles/${t.id}/documents`,{onSuccess:xs})},e[4]=ke,e[5]=t.id,e[6]=oe):oe=e[6];const re=oe;let N,b,v,d,o,y,m,w,k,x,C,h,p,S,D,T,u;if(e[7]!==l.auth||e[8]!==n||e[9]!==f||e[10]!==c||e[11]!==ie||e[12]!==j||e[13]!==re||e[14]!==t.circulation_permit_expires_at||e[15]!==t.company||e[16]!==t.id||e[17]!==t.insurance_expires_at||e[18]!==t.make||e[19]!==t.model||e[20]!==t.name||e[21]!==t.plate||e[22]!==t.status||e[23]!==t.technical_review_expires_at||e[24]!==t.year){const ce=[{label:"Revisión Técnica",date:t.technical_review_expires_at,check:be(t.technical_review_expires_at)},{label:"Permiso de Circulación",date:t.circulation_permit_expires_at,check:be(t.circulation_permit_expires_at)},{label:"Seguro Obligatorio",date:t.insurance_expires_at,check:be(t.insurance_expires_at)}];v=es;let xe;e[42]===Symbol.for("react.memo_cache_sentinel")?(xe={title:"Material Mayor",href:"/vehicles/status"},e[42]=xe):xe=e[42];const Ce=`/vehicles/status/${t.id}`;e[43]!==Ce||e[44]!==t.name?(h=[xe,{title:t.name,href:Ce}],e[43]=Ce,e[44]=t.name,e[45]=h):h=e[45];const Se=`Detalle ${t.name}`;e[46]!==Se?(p=s.jsx(We,{title:Se}),e[46]=Se,e[47]=p):p=e[47],k="mx-auto flex w-full max-w-7xl flex-col gap-6 p-4";let he;e[48]===Symbol.for("react.memo_cache_sentinel")?(he=s.jsx(ee,{variant:"ghost",size:"icon",asChild:!0,children:s.jsx(Ne,{href:"/vehicles/status",children:s.jsx(as,{className:"h-5 w-5"})})}),e[48]=he):he=e[48];const He=t.name,De=Ve(t.status),Te=t.status==="Operative"?"En Servicio":t.status==="Workshop"?"En Taller":"Fuera de Servicio";let z;e[49]!==De||e[50]!==Te?(z=s.jsx(Ie,{className:De,children:Te}),e[49]=De,e[50]=Te,e[51]=z):z=e[51];let B;e[52]!==z||e[53]!==t.name?(B=s.jsxs("h1",{className:"flex items-center gap-3 text-2xl font-bold",children:[He,z]}),e[52]=z,e[53]=t.name,e[54]=B):B=e[54];let R;e[55]!==t.company||e[56]!==t.make||e[57]!==t.model?(R=s.jsxs("p",{className:"text-muted-foreground",children:[t.company," - ",t.make," ",t.model]}),e[55]=t.company,e[56]=t.make,e[57]=t.model,e[58]=R):R=e[58];let W;e[59]!==B||e[60]!==R?(W=s.jsxs("div",{className:"flex items-center gap-4",children:[he,s.jsxs("div",{children:[B,R]})]}),e[59]=B,e[60]=R,e[61]=W):W=e[61];const Ee=`/vehicles/logs?vehicle_id=${t.id}`;let pe;e[62]===Symbol.for("react.memo_cache_sentinel")?(pe=s.jsx(ss,{className:"mr-2 h-4 w-4"}),e[62]=pe):pe=e[62];let q;e[63]!==Ee?(q=s.jsx(ee,{variant:"outline",asChild:!0,children:s.jsxs(Ne,{href:Ee,children:[pe,"Ver Bitácora"]})}),e[63]=Ee,e[64]=q):q=e[64];const Le=`/vehicles/checklists?vehicle_id=${t.id}`;let ue;e[65]===Symbol.for("react.memo_cache_sentinel")?(ue=s.jsx(ts,{className:"mr-2 h-4 w-4"}),e[65]=ue):ue=e[65];let U;e[66]!==Le?(U=s.jsx(ee,{variant:"outline",asChild:!0,children:s.jsxs(Ne,{href:Le,children:[ue,"Ver Checklists"]})}),e[66]=Le,e[67]=U):U=e[67];let G;e[68]!==l.auth||e[69]!==n||e[70]!==t.id?(G=l.auth?.user&&(l.auth.user.role==="admin"||l.auth.user.role==="capitan"||n("vehicles.status"))&&s.jsx(ee,{asChild:!0,children:s.jsxs(Ne,{href:`/vehicles/${t.id}/edit`,children:[s.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Editar Unidad"]})}),e[68]=l.auth,e[69]=n,e[70]=t.id,e[71]=G):G=e[71];let J;e[72]!==n||e[73]!==f||e[74]!==c||e[75]!==ie||e[76]!==j||e[77]!==re?(J=n("vehicles.status")&&s.jsxs(Ue,{children:[s.jsx(Ge,{asChild:!0,children:s.jsxs(ee,{variant:"secondary",children:[s.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Actualizar Vencimientos"]})}),s.jsxs(Je,{children:[s.jsxs(Ke,{children:[s.jsx(Qe,{children:"Actualizar Documentación"}),s.jsx(Xe,{children:"Modifique las fechas de vencimiento de los documentos del vehículo."})]}),s.jsxs("form",{onSubmit:re,children:[s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Me,{htmlFor:"technical_review",children:"Revisión Técnica"}),s.jsx($e,{type:"date",value:f.technical_review_expires_at,onChange:ne=>j("technical_review_expires_at",ne.target.value)}),c.technical_review_expires_at&&s.jsx("span",{className:"text-sm text-destructive",children:c.technical_review_expires_at})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Me,{htmlFor:"circulation_permit",children:"Permiso de Circulación"}),s.jsx($e,{type:"date",value:f.circulation_permit_expires_at,onChange:ne=>j("circulation_permit_expires_at",ne.target.value)}),c.circulation_permit_expires_at&&s.jsx("span",{className:"text-sm text-destructive",children:c.circulation_permit_expires_at})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(Me,{htmlFor:"insurance",children:"Seguro Obligatorio"}),s.jsx($e,{type:"date",value:f.insurance_expires_at,onChange:ne=>j("insurance_expires_at",ne.target.value)}),c.insurance_expires_at&&s.jsx("span",{className:"text-sm text-destructive",children:c.insurance_expires_at})]})]}),s.jsx(Ye,{children:s.jsx(ee,{type:"submit",disabled:ie,children:"Guardar Cambios"})})]})]})]}),e[72]=n,e[73]=f,e[74]=c,e[75]=ie,e[76]=j,e[77]=re,e[78]=J):J=e[78];let K;e[79]!==q||e[80]!==U||e[81]!==G||e[82]!==J?(K=s.jsxs("div",{className:"flex flex-wrap gap-2",children:[q,U,G,J]}),e[79]=q,e[80]=U,e[81]=G,e[82]=J,e[83]=K):K=e[83],e[84]!==W||e[85]!==K?(x=s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[W,K]}),e[84]=W,e[85]=K,e[86]=x):x=e[86],C=ce.some(ms)&&s.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:ce.map(os)}),w="grid grid-cols-1 gap-6 md:grid-cols-3",b=g,y="md:col-span-2",e[87]===Symbol.for("react.memo_cache_sentinel")?(m=s.jsx(se,{children:s.jsx(te,{children:"Información del Vehículo"})}),e[87]=m):m=e[87],N=_,T="space-y-4";let fe;e[88]===Symbol.for("react.memo_cache_sentinel")?(fe=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Patente"}),e[88]=fe):fe=e[88];let Q;e[89]!==t.plate?(Q=s.jsxs("div",{children:[fe,s.jsx("p",{className:"text-lg font-semibold",children:t.plate})]}),e[89]=t.plate,e[90]=Q):Q=e[90];let je;e[91]===Symbol.for("react.memo_cache_sentinel")?(je=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Año"}),e[91]=je):je=e[91];let X;e[92]!==t.year?(X=s.jsxs("div",{children:[je,s.jsx("p",{className:"text-lg font-semibold",children:t.year})]}),e[92]=t.year,e[93]=X):X=e[93];let ge;e[94]===Symbol.for("react.memo_cache_sentinel")?(ge=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Marca"}),e[94]=ge):ge=e[94];let Y;e[95]!==t.make?(Y=s.jsxs("div",{children:[ge,s.jsx("p",{className:"text-lg font-semibold",children:t.make})]}),e[95]=t.make,e[96]=Y):Y=e[96];let _e;e[97]===Symbol.for("react.memo_cache_sentinel")?(_e=s.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Modelo"}),e[97]=_e):_e=e[97];let Z;e[98]!==t.model?(Z=s.jsxs("div",{children:[_e,s.jsx("p",{className:"text-lg font-semibold",children:t.model})]}),e[98]=t.model,e[99]=Z):Z=e[99],e[100]!==Q||e[101]!==X||e[102]!==Y||e[103]!==Z?(u=s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Q,X,Y,Z]}),e[100]=Q,e[101]=X,e[102]=Y,e[103]=Z,e[104]=u):u=e[104],e[105]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx("hr",{className:"my-4"}),o=s.jsx("h3",{className:"mb-2 font-medium",children:"Documentación"}),e[105]=d,e[106]=o):(d=e[105],o=e[106]),S="grid grid-cols-1 gap-4 sm:grid-cols-3",D=ce.map(ds),e[7]=l.auth,e[8]=n,e[9]=f,e[10]=c,e[11]=ie,e[12]=j,e[13]=re,e[14]=t.circulation_permit_expires_at,e[15]=t.company,e[16]=t.id,e[17]=t.insurance_expires_at,e[18]=t.make,e[19]=t.model,e[20]=t.name,e[21]=t.plate,e[22]=t.status,e[23]=t.technical_review_expires_at,e[24]=t.year,e[25]=N,e[26]=b,e[27]=v,e[28]=d,e[29]=o,e[30]=y,e[31]=m,e[32]=w,e[33]=k,e[34]=x,e[35]=C,e[36]=h,e[37]=p,e[38]=S,e[39]=D,e[40]=T,e[41]=u}else N=e[25],b=e[26],v=e[27],d=e[28],o=e[29],y=e[30],m=e[31],w=e[32],k=e[33],x=e[34],C=e[35],h=e[36],p=e[37],S=e[38],D=e[39],T=e[40],u=e[41];let E;e[107]!==S||e[108]!==D?(E=s.jsx("div",{className:S,children:D}),e[107]=S,e[108]=D,e[109]=E):E=e[109];let L;e[110]!==l.auth||e[111]!==le?(L=l.auth?.user&&(l.auth.user.company==="Comandancia"||l.auth.user.role==="admin")&&s.jsxs("div",{className:"mt-4 rounded-md bg-blue-50 p-4",children:[s.jsxs("div",{className:"mb-1 flex items-center gap-2 text-blue-800",children:[s.jsx(is,{className:"h-5 w-5"}),s.jsx("span",{className:"font-bold",children:"Inversión Total en Mantenimiento"})]}),s.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["$",(le||0).toLocaleString("es-CL")]}),s.jsx("p",{className:"mt-1 text-xs text-blue-700",children:"Suma histórica de todas los trabajos realizados."})]}),e[110]=l.auth,e[111]=le,e[112]=L):L=e[112];let $;e[113]!==N||e[114]!==d||e[115]!==o||e[116]!==E||e[117]!==L||e[118]!==T||e[119]!==u?($=s.jsxs(N,{className:T,children:[u,d,o,E,L]}),e[113]=N,e[114]=d,e[115]=o,e[116]=E,e[117]=L,e[118]=T,e[119]=u,e[120]=$):$=e[120];let M;e[121]!==b||e[122]!==y||e[123]!==m||e[124]!==$?(M=s.jsxs(b,{className:y,children:[m,$]}),e[121]=b,e[122]=y,e[123]=m,e[124]=$,e[125]=M):M=e[125];let F;e[126]!==t.status?(F=t.status==="Operative"&&s.jsxs(g,{className:"border-green-200 bg-green-50",children:[s.jsx(se,{className:"pb-2",children:s.jsxs(te,{className:"flex items-center gap-2 text-green-800",children:[s.jsx(Oe,{className:"h-5 w-5"}),"Unidad Operativa"]})}),s.jsx(_,{children:s.jsx("p",{className:"text-sm text-green-700",children:"La unidad se encuentra operativa y disponible para el servicio."})})]}),e[126]=t.status,e[127]=F):F=e[127];let A;e[128]!==r||e[129]!==t.status?(A=t.status==="Out of Service"&&r&&s.jsxs(g,{className:"border-red-200 bg-red-50",children:[s.jsx(se,{className:"pb-2",children:s.jsxs(te,{className:"flex items-center gap-2 text-red-800",children:[s.jsx(Pe,{className:"h-5 w-5"}),"Fuera de Servicio"]})}),s.jsxs(_,{className:"space-y-2",children:[s.jsx("p",{className:"text-sm font-medium text-red-900",children:"Motivo:"}),s.jsx("p",{className:"text-sm text-red-800",children:r.description}),s.jsxs("div",{className:"mt-2 flex gap-2 text-xs text-red-700",children:[s.jsx(Ae,{className:"h-3 w-3"})," ",r.date?ae(r.date):ae(r.created_at)]})]})]}),e[128]=r,e[129]=t.status,e[130]=A):A=e[130];let I;e[131]!==r||e[132]!==i||e[133]!==t.status?(I=(t.status==="Workshop"||t.status==="Out of Service"&&!r&&i)&&(i?s.jsxs(g,{className:"border-yellow-200 bg-yellow-50",children:[s.jsx(se,{className:"pb-2",children:s.jsxs(te,{className:"flex items-center gap-2 text-yellow-800",children:[s.jsx(Fe,{className:"h-5 w-5"}),"En Taller (",i.status==="Scheduled"?"Agendado":"En Proceso",")"]})}),s.jsxs(_,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:i.workshop_name}),s.jsx("p",{className:"text-sm text-yellow-800",children:i.description}),s.jsxs("div",{className:"mt-1 flex gap-2 text-xs text-yellow-700",children:[s.jsx(Ae,{className:"h-3 w-3"})," ","Ingreso:"," ",ae(i.entry_date)]})]}),i.tasks&&i.tasks.length>0&&s.jsxs("div",{className:"rounded-md bg-white/50 p-3",children:[s.jsx("h4",{className:"mb-2 text-xs font-bold tracking-wider text-yellow-900 uppercase",children:"Tareas"}),s.jsx("div",{className:"space-y-2",children:i.tasks.map(ns)})]}),i.issues&&i.issues.length>0&&s.jsxs("div",{className:"rounded-md bg-white/50 p-3",children:[s.jsx("h4",{className:"mb-2 text-xs font-bold tracking-wider text-yellow-900 uppercase",children:"Incidencias Asociadas"}),s.jsx("ul",{className:"list-disc pl-4 text-sm text-slate-700",children:i.issues.map(cs)})]})]})]}):s.jsxs(g,{className:"border-yellow-200 bg-yellow-50",children:[s.jsx(se,{className:"pb-2",children:s.jsxs(te,{className:"flex items-center gap-2 text-yellow-800",children:[s.jsx(Fe,{className:"h-5 w-5"}),"En Taller"]})}),s.jsx(_,{children:s.jsx("p",{className:"text-sm text-yellow-800",children:"No hay información detallada de la orden de trabajo."})})]})),e[131]=r,e[132]=i,e[133]=t.status,e[134]=I):I=e[134];let O;e[135]!==F||e[136]!==A||e[137]!==I?(O=s.jsxs("div",{className:"space-y-6",children:[F,A,I]}),e[135]=F,e[136]=A,e[137]=I,e[138]=O):O=e[138];let P;e[139]!==w||e[140]!==M||e[141]!==O?(P=s.jsxs("div",{className:w,children:[M,O]}),e[139]=w,e[140]=M,e[141]=O,e[142]=P):P=e[142];let V;e[143]!==t.maintenances?(V=t.maintenances&&t.maintenances.length>0&&s.jsxs(g,{children:[s.jsx(se,{children:s.jsx(te,{children:"Historial de Órdenes de Trabajo"})}),s.jsx(_,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"border-b bg-muted/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-2 py-3 font-medium",children:"Fecha Ingreso"}),s.jsx("th",{className:"p-2 py-3 font-medium",children:"Taller"}),s.jsx("th",{className:"p-2 py-3 font-medium",children:"Trabajo"}),s.jsx("th",{className:"p-2 py-3 font-medium",children:"Estado"}),s.jsx("th",{className:"p-2 py-3 text-right font-medium",children:"Costo"})]})}),s.jsx("tbody",{children:t.maintenances.map(rs)})]})})})]}),e[143]=t.maintenances,e[144]=V):V=e[144];let H;e[145]!==k||e[146]!==x||e[147]!==C||e[148]!==P||e[149]!==V?(H=s.jsxs("div",{className:k,children:[x,C,P,V]}),e[145]=k,e[146]=x,e[147]=C,e[148]=P,e[149]=V,e[150]=H):H=e[150];let me;return e[151]!==v||e[152]!==h||e[153]!==p||e[154]!==H?(me=s.jsxs(v,{breadcrumbs:h,children:[p,H]}),e[151]=v,e[152]=h,e[153]=p,e[154]=H,e[155]=me):me=e[155],me}function rs(a){return s.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/20",children:[s.jsx("td",{className:"p-2 py-3",children:ae(a.entry_date)}),s.jsx("td",{className:"p-2 py-3",children:a.workshop_name}),s.jsx("td",{className:"p-2 py-3",children:a.description}),s.jsx("td",{className:"p-2 py-3",children:s.jsx(Ie,{variant:"outline",className:["Finalizado","Entregado"].includes(a.status)?"border-green-200 bg-green-50 text-green-700":"border-yellow-200 bg-yellow-50 text-yellow-700",children:a.status})}),s.jsx("td",{className:"p-2 py-3 text-right",children:a.cost>0?`$${a.cost.toLocaleString("es-CL")}`:"-"})]},a.id)}function cs(a){return s.jsxs("li",{children:[a.description,a.status==="Resolved"&&s.jsx("span",{className:"ml-2 text-xs font-bold text-green-600",children:"(Solucionado)"})]},a.id)}function ns(a){return s.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[a.is_completed?s.jsx(Oe,{className:"mt-0.5 h-4 w-4 text-green-600"}):s.jsx("div",{className:"mt-0.5 h-4 w-4 rounded-full border-2 border-slate-300"}),s.jsx("span",{className:a.is_completed?"text-slate-700 line-through opacity-70":"font-medium text-slate-800",children:a.description})]},a.id)}function ds(a,e){return s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:a.label}),s.jsx("p",{className:"text-sm font-semibold",children:a.date?ae(a.date):"No registrado"})]},e)}function os(a,e){return!a.check||a.check.status==="ok"?null:s.jsx(g,{className:`border-l-4 ${a.check.status==="expired"?"border-l-red-500 bg-red-50":"border-l-yellow-500 bg-yellow-50"}`,children:s.jsx(_,{className:"pt-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Pe,{className:`h-5 w-5 ${a.check.status==="expired"?"text-red-600":"text-yellow-600"}`}),s.jsxs("div",{children:[s.jsxs("p",{className:`font-semibold ${a.check.status==="expired"?"text-red-700":"text-yellow-700"}`,children:[a.label," ",a.check.status==="expired"?"Vencido":"Por Vencer"]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Vence:"," ",ae(a.date)," ",s.jsxs("span",{className:"font-medium",children:["(",Math.abs(a.check.days)," ","días"," ",a.check.status==="expired"?"atrasado":"restantes",")"]})]})]})]})})},e)}function ms(a){return a.check?.status==="expired"||a.check?.status==="warning"}function xs(){}function hs(a){if(!a)return null;const e=new Date(a),t=new Date,le=e.getTime()-t.getTime(),l=Math.ceil(le/864e5);return l<0?{status:"expired",days:l}:l<=30?{status:"warning",days:l}:{status:"ok",days:l}}function ps(a){switch(a){case"Operative":return"bg-green-100 text-green-800";case"Workshop":return"bg-yellow-100 text-yellow-800";case"Out of Service":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}export{Ms as default};
