import{r as f,j as t,c as V,u as Ie,H as Re,a as Pe}from"./app-yTEI3rwQ.js";import{B as Ee}from"./badge-BY8xMe2q.js";import{u as ue,c as A,B as Me,f as Ae}from"./button-DZ84VGHC.js";import{b as ie,C as le,a as ne,d as Ve,c as oe}from"./card-Bgz7zK1Y.js";import{I as N}from"./input-BL1HE6zX.js";import{L as x}from"./label-DWQw8x66.js";import{S as ee,a as te,b as se,c as ae,d as _}from"./select-BA6DtN4D.js";import{c as me,b as he,a as U,e as Be,P as De}from"./index-DcmmnLCN.js";import{u as $e}from"./index-B0b6YiDc.js";import{P as B}from"./index-BU9YzDWi.js";import{H as pe,J as Le,I as He,u as Ke,d as ze,A as Ge}from"./app-layout-C9-ZT5uU.js";import{T as Oe}from"./textarea-CB8ESZRH.js";import{u as qe}from"./use-permissions-ls-Fk9cq.js";import{f as Ue}from"./format-CSQe5d3I.js";/* empty css            */import"./chevron-down-7GosfSqF.js";import"./check-EHhGwJXz.js";import"./index-q7GIQJN5.js";import"./shield-CZtmOvLt.js";var J="Switch",[Je,Et]=me(J),[We,Xe]=Je(J),fe=f.forwardRef((s,e)=>{const{__scopeSwitch:r,name:a,checked:i,defaultChecked:l,required:n,disabled:h,value:u="on",onCheckedChange:c,form:m,...p}=s,[o,b]=f.useState(null),j=ue(e,g=>b(g)),y=f.useRef(!1),$=o?m||!!o.closest("form"):!0,[v,D]=he({prop:i,defaultProp:l??!1,onChange:c,caller:J});return t.jsxs(We,{scope:r,checked:v,disabled:h,children:[t.jsx(B.button,{type:"button",role:"switch","aria-checked":v,"aria-required":n,"data-state":be(v),"data-disabled":h?"":void 0,disabled:h,value:u,...p,ref:j,onClick:U(s.onClick,g=>{D(C=>!C),$&&(y.current=g.isPropagationStopped(),y.current||g.stopPropagation())})}),$&&t.jsx(ge,{control:o,bubbles:!y.current,name:a,value:u,checked:v,required:n,disabled:h,form:m,style:{transform:"translateX(-100%)"}})]})});fe.displayName=J;var xe="SwitchThumb",ve=f.forwardRef((s,e)=>{const{__scopeSwitch:r,...a}=s,i=Xe(xe,r);return t.jsx(B.span,{"data-state":be(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:e})});ve.displayName=xe;var Qe="SwitchBubbleInput",ge=f.forwardRef(({__scopeSwitch:s,control:e,checked:r,bubbles:a=!0,...i},l)=>{const n=f.useRef(null),h=ue(n,l),u=$e(r),c=Be(e);return f.useEffect(()=>{const m=n.current;if(!m)return;const p=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(p,"checked").set;if(u!==r&&b){const j=new Event("click",{bubbles:a});b.call(m,r),m.dispatchEvent(j)}},[u,r,a]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:h,style:{...i.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ge.displayName=Qe;function be(s){return s?"checked":"unchecked"}var Ye=fe,Ze=ve;function et(s){const e=V.c(9);let r,a;e[0]!==s?({className:r,...a}=s,e[0]=s,e[1]=r,e[2]=a):(r=e[1],a=e[2]);let i;e[3]!==r?(i=A("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),e[3]=r,e[4]=i):i=e[4];let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx(Ze,{"data-slot":"switch-thumb",className:A("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")}),e[5]=l):l=e[5];let n;return e[6]!==a||e[7]!==i?(n=t.jsx(Ye,{"data-slot":"switch",className:i,...a,children:l}),e[6]=a,e[7]=i,e[8]=n):n=e[8],n}var W="Tabs",[tt,Mt]=me(W,[pe]),je=pe(),[st,re]=tt(W),_e=f.forwardRef((s,e)=>{const{__scopeTabs:r,value:a,onValueChange:i,defaultValue:l,orientation:n="horizontal",dir:h,activationMode:u="automatic",...c}=s,m=Ke(h),[p,o]=he({prop:a,onChange:i,defaultProp:l??"",caller:W});return t.jsx(st,{scope:r,baseId:ze(),value:p,onValueChange:o,orientation:n,dir:m,activationMode:u,children:t.jsx(B.div,{dir:m,"data-orientation":n,...c,ref:e})})});_e.displayName=W;var ye="TabsList",Ne=f.forwardRef((s,e)=>{const{__scopeTabs:r,loop:a=!0,...i}=s,l=re(ye,r),n=je(r);return t.jsx(He,{asChild:!0,...n,orientation:l.orientation,dir:l.dir,loop:a,children:t.jsx(B.div,{role:"tablist","aria-orientation":l.orientation,...i,ref:e})})});Ne.displayName=ye;var Ce="TabsTrigger",Se=f.forwardRef((s,e)=>{const{__scopeTabs:r,value:a,disabled:i=!1,...l}=s,n=re(Ce,r),h=je(r),u=Te(n.baseId,a),c=Fe(n.baseId,a),m=a===n.value;return t.jsx(Le,{asChild:!0,...h,focusable:!i,active:m,children:t.jsx(B.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":c,"data-state":m?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:u,...l,ref:e,onMouseDown:U(s.onMouseDown,p=>{!i&&p.button===0&&p.ctrlKey===!1?n.onValueChange(a):p.preventDefault()}),onKeyDown:U(s.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&n.onValueChange(a)}),onFocus:U(s.onFocus,()=>{const p=n.activationMode!=="manual";!m&&!i&&p&&n.onValueChange(a)})})})});Se.displayName=Ce;var ke="TabsContent",we=f.forwardRef((s,e)=>{const{__scopeTabs:r,value:a,forceMount:i,children:l,...n}=s,h=re(ke,r),u=Te(h.baseId,a),c=Fe(h.baseId,a),m=a===h.value,p=f.useRef(m);return f.useEffect(()=>{const o=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(o)},[]),t.jsx(De,{present:i||m,children:({present:o})=>t.jsx(B.div,{"data-state":m?"active":"inactive","data-orientation":h.orientation,role:"tabpanel","aria-labelledby":u,hidden:!o,id:c,tabIndex:0,...n,ref:e,style:{...s.style,animationDuration:p.current?"0s":void 0},children:o&&l})})});we.displayName=ke;function Te(s,e){return`${s}-trigger-${e}`}function Fe(s,e){return`${s}-content-${e}`}var at=_e,rt=Ne,it=Se,lt=we;function nt(s){const e=V.c(8);let r,a;e[0]!==s?({className:r,...a}=s,e[0]=s,e[1]=r,e[2]=a):(r=e[1],a=e[2]);let i;e[3]!==r?(i=A("flex flex-col gap-2",r),e[3]=r,e[4]=i):i=e[4];let l;return e[5]!==a||e[6]!==i?(l=t.jsx(at,{"data-slot":"tabs",className:i,...a}),e[5]=a,e[6]=i,e[7]=l):l=e[7],l}function ot(s){const e=V.c(8);let r,a;e[0]!==s?({className:r,...a}=s,e[0]=s,e[1]=r,e[2]=a):(r=e[1],a=e[2]);let i;e[3]!==r?(i=A("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",r),e[3]=r,e[4]=i):i=e[4];let l;return e[5]!==a||e[6]!==i?(l=t.jsx(rt,{"data-slot":"tabs-list",className:i,...a}),e[5]=a,e[6]=i,e[7]=l):l=e[7],l}function ce(s){const e=V.c(8);let r,a;e[0]!==s?({className:r,...a}=s,e[0]=s,e[1]=r,e[2]=a):(r=e[1],a=e[2]);let i;e[3]!==r?(i=A("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",r),e[3]=r,e[4]=i):i=e[4];let l;return e[5]!==a||e[6]!==i?(l=t.jsx(it,{"data-slot":"tabs-trigger",className:i,...a}),e[5]=a,e[6]=i,e[7]=l):l=e[7],l}function de(s){const e=V.c(8);let r,a;e[0]!==s?({className:r,...a}=s,e[0]=s,e[1]=r,e[2]=a):(r=e[1],a=e[2]);let i;e[3]!==r?(i=A("flex-1 outline-none",r),e[3]=r,e[4]=i):i=e[4];let l;return e[5]!==a||e[6]!==i?(l=t.jsx(lt,{"data-slot":"tabs-content",className:i,...a}),e[5]=a,e[6]=i,e[7]=l):l=e[7],l}function At(s){const e=V.c(51),{logs:r,vehicles:a,filters:i}=s,{canCreate:l}=qe();let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=Ue(new Date,"yyyy-MM-dd"),e[0]=n):n=e[0];let h;e[1]===Symbol.for("react.memo_cache_sentinel")?(h={vehicle_id:"",start_km:"",end_km:"",activity_type:"",destination:"",date:n,fuel_liters:"",fuel_coupon:"",has_fuel:!1,receipt:null,observations:""},e[1]=h):h=e[1];const{data:u,setData:c,post:m,processing:p,errors:o,reset:b}=Ie(h);let j;e[2]!==m||e[3]!==b?(j=d=>{d.preventDefault(),m("/vehicles/logs",{onSuccess:()=>b()})},e[2]=m,e[3]=b,e[4]=j):j=e[4];const y=j,$=ht;let v;e[5]!==c||e[6]!==a?(v=d=>{c("vehicle_id",d);const Y=a.find(Z=>Z.id.toString()===d);Y&&Y.last_mileage&&c(Z=>({...Z,vehicle_id:d,start_km:String(Y.last_mileage)}))},e[5]=c,e[6]=a,e[7]=v):v=e[7];const D=v;let g,C;e[8]===Symbol.for("react.memo_cache_sentinel")?(g=[{title:"Material Mayor",href:"/vehicles/dashboard"},{title:"Bitácora",href:"/vehicles/logs"}],C=t.jsx(Re,{title:"Bitácora de Máquinas"}),e[8]=g,e[9]=C):(g=e[8],C=e[9]);let L;e[10]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Bitácora del Material Mayor"}),t.jsx("p",{className:"text-muted-foreground",children:"Control de kilometraje y movimientos de las unidades."})]}),e[10]=L):L=e[10];const X=l("vehicles.logs")?"register":"history";let S;e[11]!==l?(S=l("vehicles.logs")&&t.jsx(ce,{value:"register",children:"Registrar Movimiento"}),e[11]=l,e[12]=S):S=e[12];let H;e[13]===Symbol.for("react.memo_cache_sentinel")?(H=t.jsx(ce,{value:"history",children:"Ver Bitácoras"}),e[13]=H):H=e[13];let k;e[14]!==S?(k=t.jsxs(ot,{className:"grid w-full grid-cols-2 md:w-[400px]",children:[S,H]}),e[14]=S,e[15]=k):k=e[15];let w;e[16]!==l||e[17]!==u||e[18]!==o||e[19]!==D||e[20]!==p||e[21]!==c||e[22]!==y||e[23]!==a?(w=l("vehicles.logs")&&t.jsx(de,{value:"register",children:t.jsxs(ie,{children:[t.jsxs(le,{children:[t.jsx(ne,{children:"Nueva Entrada de Bitácora"}),t.jsx(Ve,{children:"Registre la salida o movimiento de una unidad."})]}),t.jsx(oe,{children:t.jsxs("form",{onSubmit:y,className:"max-w-2xl space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"vehicle",children:"Vehículo"}),t.jsxs(ee,{onValueChange:D,value:u.vehicle_id,children:[t.jsx(te,{children:t.jsx(se,{placeholder:"Seleccione unidad"})}),t.jsx(ae,{children:a.map(mt)})]}),o.vehicle_id&&t.jsx("p",{className:"text-sm text-destructive",children:o.vehicle_id})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"date",children:"Fecha"}),t.jsx(N,{type:"date",value:u.date,onChange:d=>c("date",d.target.value),onClick:ut}),o.date&&t.jsx("p",{className:"text-sm text-destructive",children:o.date})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"start_km",children:"Kilometraje Inicio"}),t.jsx(N,{type:"number",value:u.start_km,onChange:d=>c("start_km",d.target.value)}),o.start_km&&t.jsx("p",{className:"text-sm text-destructive",children:o.start_km})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"end_km",children:"Kilometraje Fin (Opcional)"}),t.jsx(N,{type:"number",value:u.end_km,onChange:d=>c("end_km",d.target.value)}),o.end_km&&t.jsx("p",{className:"text-sm text-destructive",children:o.end_km})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"activity",children:"Tipo de Actividad"}),t.jsxs(ee,{onValueChange:d=>c("activity_type",d),value:u.activity_type,children:[t.jsx(te,{children:t.jsx(se,{placeholder:"Seleccione tipo"})}),t.jsxs(ae,{children:[t.jsx(_,{value:"Emergencia",children:"Emergencia (10-0)"}),t.jsx(_,{value:"Academia",children:"Academia / Ejercicio"}),t.jsx(_,{value:"Tramite",children:"Trámite Administrativo"}),t.jsx(_,{value:"Taller",children:"Traslado a Taller"}),t.jsx(_,{value:"CargaCombustible",children:"Carga de Combustible"})]})]}),o.activity_type&&t.jsx("p",{className:"text-sm text-destructive",children:o.activity_type})]}),t.jsx("div",{className:"space-y-4 rounded-lg border p-4",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(et,{id:"fuel-mode",checked:u.has_fuel,onCheckedChange:d=>c("has_fuel",d)}),t.jsx(x,{htmlFor:"fuel-mode",children:"¿Fue a Cargar Combustible?"})]})}),u.has_fuel&&t.jsxs("div",{className:"space-y-4 rounded-lg border p-4",children:[t.jsx("h3",{className:"font-semibold",children:"Detalle de Carga"}),t.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"fuel_liters",children:"Litros Cargados"}),t.jsx(N,{type:"number",step:"0.01",value:u.fuel_liters,onChange:d=>c("fuel_liters",d.target.value),placeholder:"0.0"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"fuel_coupon",children:"Nº Cupón / Vale"}),t.jsx(N,{value:u.fuel_coupon,onChange:d=>c("fuel_coupon",d.target.value),placeholder:"Nº Documento"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"receipt",children:"Fotografía Boleta/Vale"}),t.jsx(N,{id:"receipt",type:"file",accept:"image/*",onChange:d=>c("receipt",d.target.files?d.target.files[0]:null)})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"destination",children:"Destino / Detalle"}),t.jsx(N,{value:u.destination,onChange:d=>c("destination",d.target.value),placeholder:"Dirección o lugar de destino"}),o.destination&&t.jsx("p",{className:"text-sm text-destructive",children:o.destination})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{htmlFor:"observations",children:"Observaciones (Opcional)"}),t.jsx(Oe,{value:u.observations,onChange:d=>c("observations",d.target.value),placeholder:"Detalle cualquier novedad o incidencia..."}),o.observations&&t.jsx("p",{className:"text-sm text-destructive",children:o.observations})]}),t.jsx(Me,{type:"submit",disabled:p,children:"Registrar Movimiento"})]})})]})}),e[16]=l,e[17]=u,e[18]=o,e[19]=D,e[20]=p,e[21]=c,e[22]=y,e[23]=a,e[24]=w):w=e[24];let K;e[25]===Symbol.for("react.memo_cache_sentinel")?(K=t.jsx(ne,{children:"Historial de Bitácoras"}),e[25]=K):K=e[25];const Q=i?.vehicle_id||"all";let z;e[26]===Symbol.for("react.memo_cache_sentinel")?(z=t.jsx(te,{children:t.jsx(se,{placeholder:"Filtrar por Vehículo"})}),e[26]=z):z=e[26];let G;e[27]===Symbol.for("react.memo_cache_sentinel")?(G=t.jsx(_,{value:"all",children:"Todos los Vehículos"}),e[27]=G):G=e[27];let T;e[28]!==a?(T=a.map(dt),e[28]=a,e[29]=T):T=e[29];let F;e[30]!==T?(F=t.jsxs(ae,{children:[G,T]}),e[30]=T,e[31]=F):F=e[31];let I;e[32]!==Q||e[33]!==F?(I=t.jsxs(le,{className:"flex flex-row items-center justify-between",children:[K,t.jsx("div",{className:"w-[250px]",children:t.jsxs(ee,{value:Q,onValueChange:$,children:[z,F]})})]}),e[32]=Q,e[33]=F,e[34]=I):I=e[34];let O;e[35]===Symbol.for("react.memo_cache_sentinel")?(O=t.jsx("thead",{className:"bg-muted/50",children:t.jsxs("tr",{className:"border-b",children:[t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Fecha"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Unidad"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Actividad"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Destino"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Km Salida"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Km Llegada"}),t.jsx("th",{className:"h-12 px-4 text-left font-medium",children:"Conductor"})]})}),e[35]=O):O=e[35];let R;e[36]!==r.data?(R=r.data.map(ct),e[36]=r.data,e[37]=R):R=e[37];let P;e[38]!==r.data.length?(P=r.data.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"p-4 text-center text-muted-foreground",children:"No hay registros."})}),e[38]=r.data.length,e[39]=P):P=e[39];let E;e[40]!==R||e[41]!==P?(E=t.jsx(oe,{children:t.jsx("div",{className:"overflow-x-auto rounded-md border",children:t.jsxs("table",{className:"w-full min-w-[800px] text-sm md:min-w-full",children:[O,t.jsxs("tbody",{children:[R,P]})]})})}),e[40]=R,e[41]=P,e[42]=E):E=e[42];let M;e[43]!==I||e[44]!==E?(M=t.jsx(de,{value:"history",children:t.jsxs(ie,{children:[I,E]})}),e[43]=I,e[44]=E,e[45]=M):M=e[45];let q;return e[46]!==k||e[47]!==w||e[48]!==M||e[49]!==X?(q=t.jsxs(Ge,{breadcrumbs:g,children:[C,t.jsxs("div",{className:"flex h-full flex-col gap-6 p-4",children:[L,t.jsxs(nt,{defaultValue:X,className:"w-full",children:[k,w,M]})]})]}),e[46]=k,e[47]=w,e[48]=M,e[49]=X,e[50]=q):q=e[50],q}function ct(s){return t.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[t.jsx("td",{className:"p-4",children:Ae(s.date)}),t.jsx("td",{className:"p-4 font-medium",children:s.vehicle.name}),t.jsx("td",{className:"p-4",children:t.jsx(Ee,{variant:"outline",children:s.activity_type})}),t.jsx("td",{className:"p-4",children:s.destination}),t.jsx("td",{className:"p-4",children:s.start_km}),t.jsx("td",{className:"p-4",children:s.end_km||"-"}),t.jsx("td",{className:"p-4",children:s.driver?.name})]},s.id)}function dt(s){return t.jsx(_,{value:s.id.toString(),children:s.name},s.id)}function ut(s){return s.currentTarget.showPicker()}function mt(s){return t.jsx(_,{value:s.id.toString(),children:s.name},s.id)}function ht(s){Pe.get("/vehicles/logs",{vehicle_id:s==="all"?void 0:s},{preserveState:!0,preserveScroll:!0,replace:!0})}export{At as default};
